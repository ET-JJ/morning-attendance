 <script>
        // ===== API 모듈 (인라인 통합) =====
        const AttendanceAPI = {
            // 오프라인 우선 API 시스템
            baseUrl: 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec',
            
            // 로컬 스토리지 키
            storageKeys: {
                attendance: 'attendanceData',
                lastSync: 'lastSyncTime',
                offlineQueue: 'offlineQueue'
            },

            // 로컬 데이터 저장
            saveToLocal(data, key = 'attendanceData') {
                try {
                    const existingData = this.getFromLocal(key);
                    const newData = Array.isArray(existingData) ? [...existingData, data] : [data];
                    localStorage.setItem(key, JSON.stringify(newData));
                    return true;
                } catch (error) {
                    console.error('로컬 저장 실패:', error);
                    return false;
                }
            },

            // 로컬 데이터 조회
            getFromLocal(key = 'attendanceData') {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('로컬 조회 실패:', error);
                    return [];
                }
            },

            // 출결 데이터 조회
            async getAttendanceData() {
                return new Promise((resolve) => {
                    const localData = this.getFromLocal();
                    resolve({
                        success: true,
                        data: localData,
                        source: 'local'
                    });
                });
            },

            // 출결 데이터 저장
            async saveAttendance(attendanceData) {
                return new Promise((resolve) => {
                    const success = this.saveToLocal(attendanceData);
                    
                    if (success) {
                        // 오프라인 큐에도 추가 (나중에 동기화용)
                        this.addToOfflineQueue(attendanceData);
                        
                        resolve({
                            success: true,
                            message: '출결이 성공적으로 저장되었습니다.',
                            source: 'local'
                        });
                    } else {
                        resolve({
                            success: false,
                            message: '저장 중 오류가 발생했습니다.',
                            source: 'local'
                        });
                    }
                });
            },

            // 오프라인 큐 관리
            addToOfflineQueue(data) {
                const queue = this.getFromLocal('offlineQueue');
                queue.push({
                    action: 'save',
                    data: data,
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem('offlineQueue', JSON.stringify(queue));
            },

            // Google Apps Script와 동기화 시도 (선택적)
            async syncWithGoogleScript(data) {
                try {
                    const response = await fetch(this.baseUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    
                    return await response.json();
                } catch (error) {
                    console.log('Google Script 동기화 실패, 로컬 저장으로 계속:', error);
                    return { success: false, error: error.message };
                }
            },

            // 통계 계산
            calculateStats(data) {
                const today = new Date().toDateString();
                const todayRecords = data.filter(record => 
                    new Date(record.timestamp).toDateString() === today
                );

                const totalStudents = new Set(data.map(record => record.studentId)).size;
                const todayAttendance = new Set(todayRecords.map(record => record.studentId)).size;

                // 시간대별 입실 현황
                const timeSlots = {
                    '05:00-06:00': 0,
                    '06:00-07:00': 0,
                    '07:00-08:00': 0
                };

                todayRecords.forEach(record => {
                    if (record.status === '입실') {
                        const hour = new Date(record.timestamp).getHours();
                        if (hour === 5) timeSlots['05:00-06:00']++;
                        else if (hour === 6) timeSlots['06:00-07:00']++;
                        else if (hour === 7) timeSlots['07:00-08:00']++;
                    }
                });

                return {
                    totalStudents,
                    todayAttendance,
                    attendanceRate: totalStudents > 0 ? Math.round((todayAttendance / totalStudents) * 100) : 0,
                    timeSlots,
                    todayRecords
                };
            }
        };

        let currentStudentId = null;
        let weeklyChart = null;
        let monthlyChart = null;
