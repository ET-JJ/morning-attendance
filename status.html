<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¶œê²° í˜„í™© - ê´‘ì˜ì—¬ê³  ì•„ì¹¨ììŠµ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JJ ì„ ìƒë‹˜ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <!-- Google Apps Script ì—°ë™ API - ì¸ë¼ì¸ìœ¼ë¡œ í¬í•¨ -->
    <style>
        body { font-family: 'Arial', sans-serif; }
        .btn-hover:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="login" class="min-h-screen flex items-center justify-center gradient-bg">
        <div class="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user-shield text-indigo-600 text-2xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">JJ ì„ ìƒë‹˜ ì „ìš©</h1>
                <p class="text-gray-600 mb-2">ì•„ì¹¨ììŠµ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
                <p class="text-sm text-green-600">ì™„ì „í•œ ì‚­ì œ ê¸°ëŠ¥ í¬í•¨</p>
            </div>
            
            <div class="space-y-4">
                <input 
                    type="password" 
                    id="password" 
                    placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" 
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-center"
                    onkeypress="if(event.key==='Enter') login()"
                >
                <button 
                    onclick="login()" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-lg font-semibold btn-hover transition-all"
                >
                    <i class="fas fa-sign-in-alt mr-2"></i>ê´€ë¦¬ì ë¡œê·¸ì¸
                </button>
                
                <div class="text-center text-sm text-gray-500 space-y-1">
                    <div class="text-xs text-gray-400">
                        <i class="fas fa-lock mr-1"></i>
                        JJ ì„ ìƒë‹˜ ì „ìš© - ìŠ¹ì¸ëœ ê³„ì •ë§Œ ì ‘ê·¼ ê°€ëŠ¥
                    </div>
                    <div class="text-xs text-blue-600">2024.09.26 ë³´ì•ˆ ê°•í™” ë²„ì „</div>
                </div>
            </div>

            <div class="mt-6 text-center">
                <a href="index.html" class="text-sm text-indigo-600 hover:text-indigo-800">
                    ì¶œê²° ì…ë ¥ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
                </a>
            </div>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ -->
    <div id="dashboard" class="hidden min-h-screen bg-gray-50">
        <!-- í—¤ë” -->
        <div class="gradient-bg text-white py-4">
            <div class="max-w-6xl mx-auto px-4 flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-bold flex items-center">
                        <i class="fas fa-tachometer-alt mr-2"></i>
                        JJ ì„ ìƒë‹˜ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
                    </h1>
                    <p class="text-sm text-indigo-200">ê´‘ì˜ì—¬ìê³ ë“±í•™êµ ì•„ì¹¨ììŠµ ì‹œìŠ¤í…œ v2.0</p>
                </div>
                <div class="text-right">
                    <div class="text-sm" id="current-time"></div>
                    <button onclick="logout()" class="text-xs bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-1 rounded mt-1 transition-colors">
                        <i class="fas fa-sign-out-alt mr-1"></i>ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ ë‚´ìš© -->
        <div class="max-w-6xl mx-auto p-4">
            <!-- í†µê³„ ì¹´ë“œ -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white p-4 rounded-xl shadow-sm border">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">ì´ í•™ìƒ</p>
                            <p class="text-2xl font-bold text-blue-600" id="total-students">0</p>
                        </div>
                        <i class="fas fa-users text-blue-400 text-xl"></i>
                    </div>
                </div>
                
                <div class="bg-white p-4 rounded-xl shadow-sm border">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">ì™„ë£Œ</p>
                            <p class="text-2xl font-bold text-green-600" id="completed">0</p>
                        </div>
                        <i class="fas fa-check-circle text-green-400 text-xl"></i>
                    </div>
                </div>
                
                <div class="bg-white p-4 rounded-xl shadow-sm border">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">ì§„í–‰ì¤‘</p>
                            <p class="text-2xl font-bold text-yellow-600" id="ongoing">0</p>
                        </div>
                        <i class="fas fa-clock text-yellow-400 text-xl"></i>
                    </div>
                </div>
                
                <div class="bg-white p-4 rounded-xl shadow-sm border">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">ë¯¸ì…ë ¥</p>
                            <p class="text-2xl font-bold text-red-600" id="missing">0</p>
                        </div>
                        <i class="fas fa-exclamation-triangle text-red-400 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Google Apps Script ì—°ë™ ìƒíƒœ -->
            <div class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl p-6 mb-6 shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-bold flex items-center">
                            <i class="fas fa-link mr-3"></i>
                            Google Apps Script v8 ì—°ë™ ìƒíƒœ
                        </h3>
                        <p class="text-sm opacity-90 mt-1">JJ ì„ ìƒë‹˜ì˜ ê¸°ì¡´ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì‹œìŠ¤í…œ</p>
                        <div class="flex items-center mt-2">
                            <div id="connection-status" class="flex items-center">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                <span class="text-sm">ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <button onclick="setGoogleAppsScriptUrl()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg text-sm font-medium transition-colors mb-2 block">
                            <i class="fas fa-link mr-1"></i>URL ì„¤ì •
                        </button>
                        <button onclick="checkConnection()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            <i class="fas fa-sync mr-1"></i>ìƒíƒœ í™•ì¸
                        </button>
                    </div>
                </div>
                
                <!-- ì—°ë™ ê¸°ëŠ¥ ë²„íŠ¼ë“¤ -->
                <div id="integration-features" class="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                    <button onclick="syncWithGoogleSheets()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-3 rounded-lg text-sm transition-colors text-left">
                        <i class="fas fa-cloud-upload-alt text-lg mb-1 block"></i>
                        <div class="font-medium">ë°ì´í„° ë™ê¸°í™”</div>
                        <div class="text-xs opacity-80">ì˜¤í”„ë¼ì¸ â†’ êµ¬ê¸€ ì „ì†¡</div>
                    </button>
                    
                    <button onclick="importFromGoogleSheets()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-3 rounded-lg text-sm transition-colors text-left">
                        <i class="fas fa-cloud-download-alt text-lg mb-1 block"></i>
                        <div class="font-medium">ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</div>
                        <div class="text-xs opacity-80">êµ¬ê¸€ â†’ ì›¹ì‹œìŠ¤í…œ</div>
                    </button>
                    
                    <button onclick="exportToGoogleSheets()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-3 rounded-lg text-sm transition-colors text-left">
                        <i class="fas fa-cloud-upload-alt text-lg mb-1 block"></i>
                        <div class="font-medium">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</div>
                        <div class="text-xs opacity-80">ì›¹ì‹œìŠ¤í…œ â†’ êµ¬ê¸€</div>
                    </button>
                    
                    <button onclick="triggerAutomation()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-3 rounded-lg text-sm transition-colors text-left">
                        <i class="fas fa-robot text-lg mb-1 block"></i>
                        <div class="font-medium">ìë™í™” ì‹¤í–‰</div>
                        <div class="text-xs opacity-80">ëˆ„ë½ ë°ì´í„° ìë™ ì²˜ë¦¬</div>
                    </button>
                    
                    <button onclick="syncBothWays()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-3 rounded-lg text-sm transition-colors text-left">
                        <i class="fas fa-sync-alt text-lg mb-1 block"></i>
                        <div class="font-medium">ì–‘ë°©í–¥ ë™ê¸°í™”</div>
                        <div class="text-xs opacity-80">ì™„ì „ ë™ê¸°í™” ì‹¤í–‰</div>
                    </button>
                    
                    <button onclick="openSpreadsheet()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-3 rounded-lg text-sm transition-colors text-left">
                        <i class="fas fa-external-link-alt text-lg mb-1 block"></i>
                        <div class="font-medium">ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì—´ê¸°</div>
                        <div class="text-xs opacity-80">êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì§ì ‘ í™•ì¸</div>
                    </button>
                </div>
            </div>

            <!-- ê´€ë¦¬ ê¸°ëŠ¥ ë²„íŠ¼ë“¤ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <button onclick="exportData()" class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-xl btn-hover transition-all text-left">
                    <i class="fas fa-download text-xl mb-2 block"></i>
                    <div class="font-semibold">CSV ë‹¤ìš´ë¡œë“œ</div>
                    <div class="text-xs opacity-90">ë¡œì»¬ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</div>
                </button>
                
                <button onclick="deleteToday()" class="bg-orange-500 hover:bg-orange-600 text-white p-4 rounded-xl btn-hover transition-all text-left">
                    <i class="fas fa-calendar-times text-xl mb-2 block"></i>
                    <div class="font-semibold">ì˜¤ëŠ˜ ë°ì´í„° ì‚­ì œ</div>
                    <div class="text-xs opacity-90">ì˜¤ëŠ˜ ë¡œì»¬ ê¸°ë¡ë§Œ ì‚­ì œ</div>
                </button>
                
                <button onclick="deleteAll()" class="bg-red-500 hover:bg-red-600 text-white p-4 rounded-xl btn-hover transition-all text-left">
                    <i class="fas fa-trash text-xl mb-2 block"></i>
                    <div class="font-semibold">ë¡œì»¬ ë°ì´í„° ì‚­ì œ</div>
                    <div class="text-xs opacity-90">ë¡œì»¬ ì €ì¥ì†Œë§Œ ì´ˆê¸°í™”</div>
                </button>
                
                <button onclick="viewStatus()" class="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-xl btn-hover transition-all text-left">
                    <i class="fas fa-chart-bar text-xl mb-2 block"></i>
                    <div class="font-semibold">ì „ì²´ í˜„í™©</div>
                    <div class="text-xs opacity-90">í˜„í™© í˜ì´ì§€ ì´ë™</div>
                </button>
            </div>

            <!-- ë°ì´í„° ëª©ë¡ -->
            <div class="bg-white rounded-xl shadow-sm border p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center">
                        <i class="fas fa-list mr-2"></i>ì¶œê²° ê¸°ë¡ ê´€ë¦¬
                        <span class="ml-2 text-sm font-normal text-gray-500" id="record-count">ì´ 0ê°œ ê¸°ë¡</span>
                    </h3>
                    <div class="flex space-x-2">
                        <button onclick="showAll()" class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded text-sm hover:bg-indigo-200 transition-colors">ì „ì²´</button>
                        <button onclick="showToday()" class="px-3 py-1 bg-green-100 text-green-700 rounded text-sm hover:bg-green-200 transition-colors">ì˜¤ëŠ˜</button>
                        <button onclick="showByStudent()" class="px-3 py-1 bg-purple-100 text-purple-700 rounded text-sm hover:bg-purple-200 transition-colors">í•™ìƒë³„</button>
                    </div>
                </div>
                
                <div id="data-list" class="space-y-2 max-h-96 overflow-y-auto">
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-database text-3xl mb-2 text-gray-300"></i>
                        <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentView = 'all';
        
        function updateTime() {
            const now = new Date();
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = now.toLocaleString('ko-KR');
            }
        }

        function login() {
            const password = document.getElementById('password').value;
            if (password === 'jj2024' || password === 'ê´‘ì˜ì—¬ê³ 2024' || password === 'admin123') {
                document.getElementById('login').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                updateStats();
                showAll();
                setInterval(updateTime, 1000);
                updateTime();
                console.log('ë¡œê·¸ì¸ ì„±ê³µ - JJ ì„ ìƒë‹˜ ê´€ë¦¬ì ì‹œìŠ¤í…œ');
            } else {
                alert('ì˜¬ë°”ë¥´ì§€ ì•Šì€ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.');
                document.getElementById('password').value = '';
                document.getElementById('password').focus();
            }
        }

        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('login').classList.remove('hidden');
                document.getElementById('dashboard').classList.add('hidden');
                document.getElementById('password').value = '';
            }
        }

        function getData() {
            return JSON.parse(localStorage.getItem('attendanceData') || '[]');
        }

        function getTodayData() {
            const data = getData();
            const today = new Date().toDateString();
            return data.filter(record => new Date(record.timestamp).toDateString() === today);
        }

        function updateStats() {
            const todayData = getTodayData();
            const students = {};
            
            todayData.forEach(record => {
                if (!students[record.studentId]) {
                    students[record.studentId] = { checkIn: false, checkOut: false };
                }
                if (record.status === 'ì…ì‹¤') students[record.studentId].checkIn = true;
                if (record.status === 'í‡´ì‹¤') students[record.studentId].checkOut = true;
            });

            const totalStudents = Object.keys(students).length;
            const completed = Object.values(students).filter(s => s.checkIn && s.checkOut).length;
            const ongoing = Object.values(students).filter(s => s.checkIn && !s.checkOut).length;
            const missing = Object.values(students).filter(s => !s.checkIn).length;

            document.getElementById('total-students').textContent = totalStudents;
            document.getElementById('completed').textContent = completed;
            document.getElementById('ongoing').textContent = ongoing;
            document.getElementById('missing').textContent = missing;
        }

        function showAll() {
            currentView = 'all';
            const data = getData();
            const container = document.getElementById('data-list');
            
            document.getElementById('record-count').textContent = 'ì´ ' + data.length + 'ê°œ ê¸°ë¡';
            
            if (data.length === 0) {
                container.innerHTML = '<div class="text-center py-12 text-gray-500"><i class="fas fa-inbox text-4xl mb-3 text-gray-300"></i><p class="font-medium">ë“±ë¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p><p class="text-sm mt-1">í•™ìƒë“¤ì´ ì¶œê²°ì„ ì…ë ¥í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p></div>';
                return;
            }

            const sortedData = data.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            container.innerHTML = sortedData.map((record, index) => 
                '<div class="flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors">' +
                '<div class="flex items-center space-x-3">' +
                '<div class="w-8 h-8 ' + (record.status === 'ì…ì‹¤' ? 'bg-green-100 text-green-600' : 'bg-blue-100 text-blue-600') + ' rounded-full flex items-center justify-center">' +
                '<i class="fas ' + (record.status === 'ì…ì‹¤' ? 'fa-sign-in-alt' : 'fa-sign-out-alt') + ' text-xs"></i>' +
                '</div>' +
                '<div>' +
                '<div class="font-medium">' + record.studentName + ' (' + record.studentId + ')</div>' +
                '<div class="text-sm text-gray-500">' + record.status + ' â€¢ ' + new Date(record.timestamp).toLocaleString('ko-KR') + '</div>' +
                '</div>' +
                '</div>' +
                '<button onclick="deleteRecord(' + index + ')" class="text-red-500 hover:text-red-700 px-2 py-1 rounded hover:bg-red-50 transition-colors">' +
                '<i class="fas fa-trash"></i>' +
                '</button>' +
                '</div>'
            ).join('');
        }

        function showToday() {
            currentView = 'today';
            const todayData = getTodayData();
            const allData = getData();
            const container = document.getElementById('data-list');
            
            document.getElementById('record-count').textContent = 'ì˜¤ëŠ˜ ' + todayData.length + 'ê°œ ê¸°ë¡';
            
            if (todayData.length === 0) {
                container.innerHTML = '<div class="text-center py-12 text-gray-500"><i class="fas fa-calendar-day text-4xl mb-3 text-gray-300"></i><p class="font-medium">ì˜¤ëŠ˜ ë“±ë¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }

            const sortedData = todayData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            container.innerHTML = sortedData.map(record => {
                const index = allData.indexOf(record);
                return '<div class="flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors">' +
                '<div class="flex items-center space-x-3">' +
                '<div class="w-8 h-8 ' + (record.status === 'ì…ì‹¤' ? 'bg-green-100 text-green-600' : 'bg-blue-100 text-blue-600') + ' rounded-full flex items-center justify-center">' +
                '<i class="fas ' + (record.status === 'ì…ì‹¤' ? 'fa-sign-in-alt' : 'fa-sign-out-alt') + ' text-xs"></i>' +
                '</div>' +
                '<div>' +
                '<div class="font-medium">' + record.studentName + ' (' + record.studentId + ')</div>' +
                '<div class="text-sm text-gray-500">' + record.status + ' â€¢ ' + new Date(record.timestamp).toLocaleTimeString('ko-KR') + '</div>' +
                '</div>' +
                '</div>' +
                '<button onclick="deleteRecord(' + index + ')" class="text-red-500 hover:text-red-700 px-2 py-1 rounded hover:bg-red-50 transition-colors">' +
                '<i class="fas fa-trash"></i>' +
                '</button>' +
                '</div>';
            }).join('');
        }

        function showByStudent() {
            currentView = 'student';
            const data = getData();
            const students = {};
            
            data.forEach(record => {
                if (!students[record.studentId]) {
                    students[record.studentId] = {
                        name: record.studentName,
                        records: []
                    };
                }
                students[record.studentId].records.push(record);
            });

            const container = document.getElementById('data-list');
            const studentCount = Object.keys(students).length;
            
            document.getElementById('record-count').textContent = studentCount + 'ëª…ì˜ í•™ìƒ ê¸°ë¡';
            
            if (studentCount === 0) {
                container.innerHTML = '<div class="text-center py-12 text-gray-500"><i class="fas fa-users text-4xl mb-3 text-gray-300"></i><p class="font-medium">ë“±ë¡ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }

            container.innerHTML = Object.entries(students).map(([studentId, data]) => 
                '<div class="border rounded-lg p-4 bg-gray-50">' +
                '<div class="flex justify-between items-center mb-2">' +
                '<h4 class="font-semibold text-gray-900">' + data.name + ' (' + studentId + ')</h4>' +
                '<div class="flex items-center space-x-2">' +
                '<span class="text-sm text-gray-500 bg-white px-2 py-1 rounded">' + data.records.length + 'ê°œ ê¸°ë¡</span>' +
                '<button onclick="deleteStudent(\'' + studentId + '\')" class="text-red-500 hover:text-red-700 text-sm bg-white px-2 py-1 rounded hover:bg-red-50 transition-colors">' +
                '<i class="fas fa-trash mr-1"></i>ì „ì²´ì‚­ì œ' +
                '</button>' +
                '</div>' +
                '</div>' +
                '<div class="space-y-1 max-h-32 overflow-y-auto">' +
                data.records.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).map(record => {
                    const allData = getData();
                    const index = allData.indexOf(record);
                    return '<div class="flex justify-between items-center text-sm p-2 bg-white rounded border">' +
                    '<span class="flex items-center">' +
                    '<div class="w-4 h-4 ' + (record.status === 'ì…ì‹¤' ? 'bg-green-100 text-green-600' : 'bg-blue-100 text-blue-600') + ' rounded-full flex items-center justify-center mr-2">' +
                    '<i class="fas ' + (record.status === 'ì…ì‹¤' ? 'fa-sign-in-alt' : 'fa-sign-out-alt') + ' text-xs"></i>' +
                    '</div>' +
                    record.status + ' â€¢ ' + new Date(record.timestamp).toLocaleString('ko-KR') +
                    '</span>' +
                    '<button onclick="deleteRecord(' + index + ')" class="text-red-500 hover:text-red-700 px-1 py-1 rounded hover:bg-red-50 transition-colors">' +
                    '<i class="fas fa-times text-xs"></i>' +
                    '</button>' +
                    '</div>';
                }).join('') +
                '</div>' +
                '</div>'
            ).join('');
        }

        function deleteRecord(index) {
            if (!confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const data = getData();
            const deletedRecord = data[index];
            data.splice(index, 1);
            localStorage.setItem('attendanceData', JSON.stringify(data));
            
            if (currentView === 'all') showAll();
            else if (currentView === 'today') showToday();
            else if (currentView === 'student') showByStudent();
            
            updateStats();
            alert(deletedRecord.studentName + 'ì˜ ' + deletedRecord.status + ' ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function deleteStudent(studentId) {
            const data = getData();
            const studentRecord = data.find(r => r.studentId === studentId);
            const studentName = studentRecord ? studentRecord.studentName : 'í•™ìƒ';
            
            const confirmName = prompt('ì •ë§ë¡œ ' + studentName + 'ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? í™•ì¸ì„ ìœ„í•´ í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!confirmName || confirmName !== studentName) {
                if (confirmName) alert('í•™ìƒ ì´ë¦„ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }
            
            const filteredData = data.filter(record => record.studentId !== studentId);
            localStorage.setItem('attendanceData', JSON.stringify(filteredData));
            
            showByStudent();
            updateStats();
            alert(studentName + ' í•™ìƒì˜ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function deleteToday() {
            const todayCount = getTodayData().length;
            if (todayCount === 0) {
                alert('ì˜¤ëŠ˜ ì‚­ì œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm('ì˜¤ëŠ˜ì˜ ëª¨ë“  ì¶œê²° ë°ì´í„° ' + todayCount + 'ê°œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) return;
            
            const allData = getData();
            const today = new Date().toDateString();
            const filteredData = allData.filter(record => 
                new Date(record.timestamp).toDateString() !== today
            );
            
            localStorage.setItem('attendanceData', JSON.stringify(filteredData));
            
            if (currentView === 'all') showAll();
            else if (currentView === 'today') showToday();
            else if (currentView === 'student') showByStudent();
            
            updateStats();
            alert('ì˜¤ëŠ˜ ë°ì´í„° ' + todayCount + 'ê°œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function deleteAll() {
            const totalCount = getData().length;
            if (totalCount === 0) {
                alert('ì‚­ì œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const confirmation = prompt('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„° ' + totalCount + 'ê°œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤! í™•ì¸í•˜ë ¤ë©´ "ëª¨ë“ ë°ì´í„°ì‚­ì œ"ë¥¼ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”:');
            
            if (confirmation !== 'ëª¨ë“ ë°ì´í„°ì‚­ì œ') {
                if (confirmation) alert('ì…ë ¥ì´ ì •í™•í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            localStorage.removeItem('attendanceData');
            
            if (currentView === 'all') showAll();
            else if (currentView === 'today') showToday();
            else if (currentView === 'student') showByStudent();
            
            updateStats();
            alert('ëª¨ë“  ë°ì´í„° ' + totalCount + 'ê°œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function exportData() {
            const data = getData();
            
            if (data.length === 0) {
                alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const csvContent = [
                ['í•™ë²ˆ', 'ì´ë¦„', 'ìƒíƒœ', 'ì‹œê°„', 'ë‚ ì§œ', 'ìë™ì²˜ë¦¬'].join(','),
                ...data.map(record => [
                    record.studentId,
                    record.studentName,
                    record.status,
                    new Date(record.timestamp).toLocaleTimeString('ko-KR'),
                    new Date(record.timestamp).toLocaleDateString('ko-KR'),
                    record.processed ? 'ìë™' : 'ìˆ˜ë™'
                ].join(','))
            ].join('\n');

            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'ê´‘ì˜ì—¬ê³ _ì¶œê²°ë°ì´í„°_' + new Date().toISOString().split('T')[0] + '.csv';
            link.click();
            
            alert('CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! (' + data.length + 'ê°œ ê¸°ë¡)');
        }

        function viewStatus() {
            window.open('status.html', '_blank');
        }

        // ========== Google Apps Script v8 API (ì¸ë¼ì¸ í¬í•¨) ==========
        
        class AttendanceAPI {
            constructor() {
                this.webAppUrl = localStorage.getItem('WEBAPP_URL') || null;
                this.isOnlineMode = this.webAppUrl ? true : false;
                console.log(`ì•„ì¹¨ììŠµ API ì´ˆê¸°í™” - ${this.isOnlineMode ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'} ëª¨ë“œ`);
            }

            setWebAppUrl(url) {
                this.webAppUrl = url;
                this.isOnlineMode = true;
                localStorage.setItem('WEBAPP_URL', url);
                console.log('êµ¬ê¸€ ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì„¤ì •ë¨:', url);
            }

            async checkConnection() {
                if (!this.webAppUrl) {
                    return { 
                        connected: false, 
                        mode: 'offline',
                        message: 'âš ï¸ êµ¬ê¸€ ì•±ìŠ¤í¬ë¦½íŠ¸ URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'
                    };
                }

                try {
                    const testResponse = await fetch(`${this.webAppUrl}?action=test&timestamp=${Date.now()}`, {
                        method: 'GET',
                        mode: 'no-cors'
                    });
                    
                    return {
                        connected: true,
                        mode: 'google_sheets_v8',
                        message: 'âœ… êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ v8 ì‹œìŠ¤í…œê³¼ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!',
                        spreadsheet_id: '1dJEOyc59eZgwidKjXiYptgreAIabfBbkndN0g17Qsb8'
                    };

                } catch (error) {
                    return {
                        connected: 'unknown',
                        mode: 'hybrid',
                        message: 'ğŸ”„ í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ: ë¡œì»¬ ì €ì¥ + êµ¬ê¸€ ì‹œìŠ¤í…œ ë™ê¸°í™”'
                    };
                }
            }

            async syncWithGoogleSheets() {
                if (!this.isOnlineMode || !this.webAppUrl) {
                    return {
                        success: false,
                        message: 'Google Apps Scriptê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'
                    };
                }

                try {
                    const localData = JSON.parse(localStorage.getItem('attendanceData') || '[]');
                    const unsyncedData = localData.filter(record => record.source === 'offline');

                    if (unsyncedData.length === 0) {
                        return {
                            success: true,
                            message: 'ë™ê¸°í™”í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
                            syncedCount: 0
                        };
                    }

                    let syncedCount = 0;
                    for (const record of unsyncedData) {
                        try {
                            const formData = new URLSearchParams();
                            formData.append('action', 'submit');
                            formData.append('student_id', record.studentId);
                            formData.append('student_name', record.studentName);
                            formData.append('status', record.status);
                            formData.append('timestamp', record.timestamp);
                            formData.append('source', 'sync_from_web');

                            await fetch(this.webAppUrl, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/x-www-form-urlencoded',
                                },
                                body: formData,
                                mode: 'no-cors'
                            });

                            record.source = 'synced';
                            record.syncedAt = new Date().toISOString();
                            syncedCount++;
                        } catch (syncError) {
                            console.warn('ê°œë³„ ë°ì´í„° ë™ê¸°í™” ì‹¤íŒ¨:', syncError);
                        }
                    }

                    localStorage.setItem('attendanceData', JSON.stringify(localData));

                    return {
                        success: true,
                        message: `âœ… ${syncedCount}ê±´ì˜ ì˜¤í”„ë¼ì¸ ë°ì´í„°ê°€ Google Sheetsì™€ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`,
                        syncedCount,
                        totalCount: unsyncedData.length
                    };

                } catch (error) {
                    console.error('Google Sheets ë™ê¸°í™” ì‹¤íŒ¨:', error);
                    return {
                        success: false,
                        message: `ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`
                    };
                }
            }

            async triggerAutomation(type = 'processMissing') {
                if (!this.isOnlineMode || !this.webAppUrl) {
                    return {
                        success: false,
                        message: 'ì˜¤í”„ë¼ì¸ ëª¨ë“œì—ì„œëŠ” ìë™í™” ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
                    };
                }

                try {
                    const params = new URLSearchParams({
                        action: type,
                        timestamp: new Date().toISOString(),
                        trigger_source: 'web_interface'
                    });

                    await fetch(`${this.webAppUrl}?${params}`, {
                        method: 'GET',
                        mode: 'no-cors'
                    });

                    return {
                        success: true,
                        message: `âœ… ${type} ìë™í™” ê¸°ëŠ¥ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.`,
                        note: 'Google Apps Scriptì—ì„œ ë°±ê·¸ë¼ìš´ë“œë¡œ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤.'
                    };

                } catch (error) {
                    console.error('ìë™í™” íŠ¸ë¦¬ê±° ì‹¤íŒ¨:', error);
                    return {
                        success: false,
                        message: `ìë™í™” ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`
                    };
                }
            }
        }

        // ì „ì—­ API ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        window.attendanceAPI = new AttendanceAPI();

        // ========== Google Apps Script v8 ì—°ë™ ê¸°ëŠ¥ ==========

        async function checkConnection() {
            const statusElement = document.getElementById('connection-status');
            statusElement.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i><span class="text-sm">ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</span>';
            
            try {
                const status = await window.attendanceAPI.checkConnection();
                
                if (status.connected === true) {
                    statusElement.innerHTML = `
                        <i class="fas fa-check-circle mr-2 text-green-300"></i>
                        <span class="text-sm">âœ… êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ v8 ì—°ê²°ë¨</span>
                    `;
                } else if (status.connected === 'unknown') {
                    statusElement.innerHTML = `
                        <i class="fas fa-wifi mr-2 text-yellow-300"></i>
                        <span class="text-sm">ğŸ”„ í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ (ë¡œì»¬+êµ¬ê¸€)</span>
                    `;
                } else {
                    statusElement.innerHTML = `
                        <i class="fas fa-exclamation-triangle mr-2 text-orange-300"></i>
                        <span class="text-sm">âš ï¸ ì˜¤í”„ë¼ì¸ ëª¨ë“œ (ë¡œì»¬ ì „ìš©)</span>
                    `;
                }
                
                console.log('ğŸ”— Google Apps Script ì—°ê²° ìƒíƒœ:', status);
                
            } catch (error) {
                console.error('ì—°ê²° ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
                statusElement.innerHTML = `
                    <i class="fas fa-times-circle mr-2 text-red-300"></i>
                    <span class="text-sm">âŒ ì—°ê²° í™•ì¸ ì‹¤íŒ¨</span>
                `;
            }
        }

        // Google Apps Script URL ì„¤ì • í•¨ìˆ˜ ì¶”ê°€
        function setGoogleAppsScriptUrl() {
            const url = prompt('Google Apps Script ì›¹ì•± URLì„ ì…ë ¥í•˜ì„¸ìš”:\n(ì˜ˆ: https://script.google.com/macros/s/.../exec)');
            
            if (!url) return;
            
            if (!url.includes('script.google.com')) {
                alert('ì˜¬ë°”ë¥¸ Google Apps Script URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            window.attendanceAPI.setWebAppUrl(url);
            alert('âœ… Google Apps Script URLì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.');
            
            // ì—°ê²° ìƒíƒœ ìë™ í™•ì¸
            setTimeout(checkConnection, 500);
        }

        // ì—°ë™ ê°€ì´ë“œë¥¼ alertë¡œ ê°„ë‹¨í•˜ê²Œ ì œê³µ
        function showIntegrationGuide() {
            alert(`ğŸš€ Google Apps Script v8 ì—°ë™ ê°€ì´ë“œ:

1ï¸âƒ£ Google Apps Script ì¤€ë¹„:
   â€¢ ê¸°ì¡´ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ â†’ í™•ì¥ í”„ë¡œê·¸ë¨ â†’ Apps Script
   â€¢ ì œê³µë°›ì€ v8 ì½”ë“œë¡œ êµì²´
   â€¢ ë°°í¬ â†’ ìƒˆ ë°°í¬ â†’ ì›¹ ì•±
   â€¢ ì‹¤í–‰ ê³„ì •: ë³¸ì¸, ì•¡ì„¸ìŠ¤: ëª¨ë“  ì‚¬ìš©ì
   â€¢ ë°°í¬ í´ë¦­í•˜ê³  URL ë³µì‚¬

2ï¸âƒ£ ì›¹ ì‹œìŠ¤í…œ ì—°ê²°:
   â€¢ "URL ì„¤ì •" ë²„íŠ¼ í´ë¦­
   â€¢ ë³µì‚¬í•œ URL ë¶™ì—¬ë„£ê¸°
   â€¢ "ìƒíƒœ í™•ì¸" ë²„íŠ¼ìœ¼ë¡œ ì—°ê²° í…ŒìŠ¤íŠ¸

3ï¸âƒ£ ì¦‰ì‹œ ì—°ë™ ì™„ë£Œ! ğŸ‰`);
        }

        async function syncWithGoogleSheets() {
            if (typeof window.attendanceAPI === 'undefined') {
                alert('âš ï¸ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }

            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ë™ê¸°í™” ì¤‘...';
            button.disabled = true;

            try {
                const result = await window.attendanceAPI.syncWithGoogleSheets();
                
                if (result.success) {
                    alert(`âœ… ${result.message}\n\në™ê¸°í™”ëœ ë°ì´í„°: ${result.syncedCount || 0}ê±´`);
                    
                    // í†µê³„ ì—…ë°ì´íŠ¸
                    updateStats();
                } else {
                    alert(`âŒ ${result.message}`);
                }
                
            } catch (error) {
                console.error('ë™ê¸°í™” ì‹¤íŒ¨:', error);
                alert('âŒ ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        async function triggerAutomation() {
            if (typeof window.attendanceAPI === 'undefined') {
                alert('âš ï¸ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }

            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ì‹¤í–‰ ì¤‘...';
            button.disabled = true;

            try {
                const result = await window.attendanceAPI.triggerAutomation('processMissing');
                
                if (result.success) {
                    alert(`ğŸ¤– ${result.message}\n\n${result.note || 'Google Apps Scriptì—ì„œ ìë™í™” ì²˜ë¦¬ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.'}`);
                } else {
                    alert(`âŒ ${result.message}`);
                }
                
            } catch (error) {
                console.error('ìë™í™” ì‹¤í–‰ ì‹¤íŒ¨:', error);
                alert('âŒ ìë™í™” ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        async function importFromGoogleSheets() {
            if (typeof window.attendanceAPI === 'undefined') {
                alert('âš ï¸ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!window.attendanceAPI.isOnlineMode || !window.attendanceAPI.webAppUrl) {
                alert('âš ï¸ Google Apps Scriptê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\në¨¼ì € "URL ì„¤ì •"ìœ¼ë¡œ êµ¬ê¸€ ì‹œíŠ¸ì™€ ì—°ê²°í•´ì£¼ì„¸ìš”.');
                return;
            }

            const confirmImport = confirm('ğŸ“¥ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì—ì„œ ì „ì²´ ì¶œê²° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€¢ ì¤‘ë³µëœ ë°ì´í„°ëŠ” ìë™ìœ¼ë¡œ ì œì™¸ë©ë‹ˆë‹¤\nâ€¢ ê¸°ì¡´ ë¡œì»¬ ë°ì´í„°ëŠ” ë³´ì¡´ë©ë‹ˆë‹¤\nâ€¢ ì‹œê°„ì´ ë‹¤ì†Œ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤');
            
            if (!confirmImport) return;

            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘...';
            button.disabled = true;

            try {
                // Google Sheetsì—ì„œ ì „ì²´ ë°ì´í„° ì¡°íšŒ
                console.log('ğŸ”— ìš”ì²­ URL:', `${window.attendanceAPI.webAppUrl}?action=getAllRecords&timestamp=${Date.now()}`);
                
                const response = await fetch(`${window.attendanceAPI.webAppUrl}?action=getAllAttendance&timestamp=${Date.now()}`, {
                    method: 'GET',
                    mode: 'cors'
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();

                if (result.status !== 'success') {
                    throw new Error(result.message || 'ë°ì´í„° ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

                const googleData = result.data || [];
                console.log(`ğŸ“Š êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ${googleData.length}ê±´ì˜ ë°ì´í„°ë¥¼ ì¡°íšŒí–ˆìŠµë‹ˆë‹¤.`);
                
                // ğŸ” ì‹¤ì œ êµ¬ê¸€ ë°ì´í„° êµ¬ì¡° í™•ì¸ (ì²˜ìŒ 3ê°œë§Œ)
                console.log('ğŸ” êµ¬ê¸€ ì‹œíŠ¸ ì›ë³¸ ë°ì´í„° ìƒ˜í”Œ:');
                googleData.slice(0, 3).forEach((record, index) => {
                    console.log(`\n=== Record ${index + 1} ===`);
                    console.log('ì „ì²´ ê°ì²´:', record);
                    console.log('ëª¨ë“  í‚¤ë“¤:', Object.keys(record));
                    console.log('ëª¨ë“  ê°’ë“¤:', Object.values(record));
                    
                    // ì˜ˆìƒ ê°€ëŠ¥í•œ ë‹¤ì–‘í•œ í•„ë“œëª…ë“¤ ì²´í¬
                    console.log('timestamp ê´€ë ¨:', {
                        timestamp: record.timestamp,
                        íƒ€ì„ìŠ¤íƒ¬í”„: record['íƒ€ì„ìŠ¤íƒ¬í”„'],
                        date: record.date,
                        ì‹œê°„: record['ì‹œê°„']
                    });
                    
                    console.log('í•™ìƒ ì •ë³´:', {
                        studentId: record.studentId,
                        í•™ë²ˆ: record['í•™ë²ˆ'],
                        studentName: record.studentName,
                        ì´ë¦„: record['ì´ë¦„']
                    });
                    
                    console.log('ìƒíƒœ ì •ë³´:', {
                        status: record.status,
                        ìƒíƒœ: record['ìƒíƒœ'],
                        action: record.action
                    });
                });

                if (googleData.length === 0) {
                    alert('ğŸ“­ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ê°€ì ¸ì˜¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // ê¸°ì¡´ ë¡œì»¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const existingData = JSON.parse(localStorage.getItem('attendanceData') || '[]');
                const existingKeys = new Set();

                // ê¸°ì¡´ ë°ì´í„°ì˜ ê³ ìœ  í‚¤ ìƒì„±
                existingData.forEach(record => {
                    const key = generateLocalUniqueKey(record);
                    existingKeys.add(key);
                });

                // ğŸ” ë””ë²„ê¹…ì„ ìœ„í•´ ì¤‘ë³µ ì œê±° ë¡œì§ ìˆ˜ì •
                let importedCount = 0;
                let skippedCount = 0;

                // ğŸš¨ ì„ì‹œë¡œ ì¤‘ë³µ ì œê±° ì™„ì „íˆ ë¹„í™œì„±í™”í•˜ì—¬ ë””ë²„ê¹…
                googleData.forEach((googleRecord, index) => {
                    if (index < 5) { // ì²˜ìŒ 5ê°œë§Œ ìì„¸íˆ ë¡œê·¸
                        console.log(`ğŸ”„ ì²˜ë¦¬ ì¤‘ ${index + 1}/${googleData.length}:`, googleRecord);
                    }
                    
                    const localRecords = convertGoogleToLocalFormat(googleRecord); // ë°°ì—´ë¡œ ë°˜í™˜ë¨
                    
                    localRecords.forEach(localRecord => {
                        // ì¤‘ë³µ ì œê±° ì—†ì´ ëª¨ë“  ë°ì´í„° ì¶”ê°€
                        existingData.push(localRecord);
                        importedCount++;
                        
                        if (index < 5) { // ì²˜ìŒ 5ê°œë§Œ ìì„¸íˆ ë¡œê·¸
                            const key = generateLocalUniqueKey(localRecord);
                            console.log('ğŸ”‘ ìƒì„±ëœ ê³ ìœ  í‚¤:', key);
                            console.log('ğŸ“… ë³€í™˜ëœ ì‹œê°„:', localRecord.timestamp);
                            console.log('ğŸ• ì‹¤ì œ ì‹œê°„ ê°ì²´:', new Date(localRecord.timestamp));
                            console.log('ğŸ‘¤ í•™ìƒì •ë³´:', localRecord.studentName, localRecord.status);
                            console.log('âœ… ë°ì´í„° ì¶”ê°€ ì™„ë£Œ\n');
                        }
                    });
                });

                // ë‚ ì§œìˆœ ì •ë ¬
                existingData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                localStorage.setItem('attendanceData', JSON.stringify(existingData));

                // í†µê³„ ì—…ë°ì´íŠ¸
                updateStats();
                showAll();

                // ê²°ê³¼ ì•Œë¦¼
                let message = `ğŸš¨ ë””ë²„ê¹… ëª¨ë“œ: ì¤‘ë³µ ì œê±° ë¹„í™œì„±í™”\n\n`;
                message += `ğŸ“Š ì´ ì¡°íšŒ: ${googleData.length}ê±´\n`;
                message += `â• ëª¨ë‘ ì¶”ê°€: ${importedCount}ê±´\n`;
                message += `ğŸ“± í˜„ì¬ ì›¹ì‹œìŠ¤í…œ ì´ ë°ì´í„°: ${existingData.length}ê±´\n\n`;
                message += `ğŸ” F12 ì½˜ì†”ì—ì„œ ë³€í™˜ ê³¼ì •ì„ í™•ì¸í•˜ì„¸ìš”!`;

                alert(message);

                console.log(`ğŸ‰ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ: ${importedCount}ê±´ ì¶”ê°€, ${skippedCount}ê±´ ì¤‘ë³µ ì œì™¸`);

            } catch (error) {
                console.error('êµ¬ê¸€ ì‹œíŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                
                let errorMessage = 'âŒ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\n';
                
                if (error.message.includes('HTTP')) {
                    errorMessage += 'ğŸ”— ì—°ê²° ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.';
                } else {
                    errorMessage += `ì˜¤ë¥˜ ë‚´ìš©: ${error.message}`;
                }
                
                alert(errorMessage);
                
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        // ğŸ¯ JJ ì„ ìƒë‹˜ êµ¬ê¸€ ì‹œíŠ¸ ì¶œì„ë¶€ ë°ì´í„° ë³€í™˜ (ìƒˆë¡œìš´ êµ¬ì¡°)
        function convertGoogleToLocalFormat(googleRecord) {
            console.log('ğŸ”„ Google Sheets ì¶œì„ë¶€ ë°ì´í„° ë³€í™˜:', googleRecord);
            
            // Google Sheets ì¶œì„ë¶€ êµ¬ì¡°: { id, date, studentId, studentName, checkInTime, checkOutTime, learningTime, source: 'google_sheets', rowNumber }
            
            const studentId = String(googleRecord.studentId || '').trim();
            const studentName = String(googleRecord.studentName || '').trim();
            const date = googleRecord.date; // ë‚ ì§œ (Date ê°ì²´ ë˜ëŠ” ë¬¸ìì—´)
            const checkInTime = googleRecord.checkInTime; // ì…ì‹¤ ì‹œê°„
            const checkOutTime = googleRecord.checkOutTime; // í‡´ì‹¤ ì‹œê°„
            
            console.log('ğŸ“Š í•„ë“œ ì¶”ì¶œ:', { date, studentId, studentName, checkInTime, checkOutTime });
            
            // í•„ìˆ˜ í•„ë“œ ê²€ì¦
            if (!studentId || !studentName || !date) {
                console.warn('âš ï¸ í•„ìˆ˜ í•„ë“œ ëˆ„ë½ - ë ˆì½”ë“œ ì œì™¸:', { studentId, studentName, date });
                return []; // ë¹ˆ ë°°ì—´ ë°˜í™˜
            }
            
            const result = [];
            
            // ë‚ ì§œ íŒŒì‹± í•¨ìˆ˜
            function parseDate(dateValue) {
                if (dateValue instanceof Date) {
                    return dateValue;
                }
                if (typeof dateValue === 'object' && dateValue !== null) {
                    // Google Sheetsì˜ íŠ¹ìˆ˜ Date ê°ì²´ ì²˜ë¦¬
                    return new Date(dateValue.toString());
                }
                return new Date(dateValue);
            }
            
            // ì‹œê°„ íŒŒì‹± í•¨ìˆ˜ (HH:mm:ss í˜•ì‹ìœ¼ë¡œ ë³€í™˜)
            function parseTime(timeValue) {
                if (!timeValue) return null;
                
                let timeStr = String(timeValue).replace(/'/g, '').trim(); // ì‘ì€ë”°ì˜´í‘œ ì œê±°
                
                // ì´ë¯¸ HH:mm:ss í˜•ì‹ì¸ ê²½ìš°
                if (/^\d{1,2}:\d{2}:\d{2}$/.test(timeStr)) {
                    return timeStr;
                }
                
                // Date ê°ì²´ì¸ ê²½ìš° ì‹œê°„ë§Œ ì¶”ì¶œ
                if (timeValue instanceof Date || (typeof timeValue === 'object' && timeValue !== null)) {
                    const dateObj = timeValue instanceof Date ? timeValue : new Date(timeValue.toString());
                    if (!isNaN(dateObj.getTime())) {
                        return dateObj.toTimeString().substring(0, 8); // HH:mm:ss
                    }
                }
                
                return timeStr;
            }
            
            // ê¸°ì¤€ ë‚ ì§œ ìƒì„±
            const baseDate = parseDate(date);
            if (isNaN(baseDate.getTime())) {
                console.error('âŒ ë‚ ì§œ íŒŒì‹± ì‹¤íŒ¨:', date);
                return [];
            }
            
            const dateString = baseDate.toISOString().split('T')[0]; // YYYY-MM-DD
            
            // ì…ì‹¤ ê¸°ë¡ ì²˜ë¦¬
            if (checkInTime) {
                const parsedCheckInTime = parseTime(checkInTime);
                if (parsedCheckInTime) {
                    const checkInDateTime = new Date(`${dateString}T${parsedCheckInTime}`);
                    
                    if (!isNaN(checkInDateTime.getTime())) {
                        result.push({
                            timestamp: checkInDateTime,
                            studentId: studentId,
                            studentName: studentName,
                            status: 'ì…ì‹¤',
                            originalDate: dateString,
                            originalTime: parsedCheckInTime,
                            source: 'google_sheets'
                        });
                        console.log('âœ… ì…ì‹¤ ê¸°ë¡ ìƒì„±:', checkInDateTime);
                    } else {
                        console.warn('âš ï¸ ì…ì‹¤ ì‹œê°„ íŒŒì‹± ì‹¤íŒ¨:', checkInTime);
                    }
                }
            }
            
            // í‡´ì‹¤ ê¸°ë¡ ì²˜ë¦¬
            if (checkOutTime) {
                const parsedCheckOutTime = parseTime(checkOutTime);
                if (parsedCheckOutTime) {
                    const checkOutDateTime = new Date(`${dateString}T${parsedCheckOutTime}`);
                    
                    if (!isNaN(checkOutDateTime.getTime())) {
                        result.push({
                            timestamp: checkOutDateTime,
                            studentId: studentId,
                            studentName: studentName,
                            status: 'í‡´ì‹¤',
                            originalDate: dateString,
                            originalTime: parsedCheckOutTime,
                            source: 'google_sheets'
                        });
                        console.log('âœ… í‡´ì‹¤ ê¸°ë¡ ìƒì„±:', checkOutDateTime);
                    } else {
                        console.warn('âš ï¸ í‡´ì‹¤ ì‹œê°„ íŒŒì‹± ì‹¤íŒ¨:', checkOutTime);
                    }
                }
            }
            
            console.log(`ğŸ“‹ ë³€í™˜ ì™„ë£Œ: ${result.length}ê°œ ì´ë²¤íŠ¸ ìƒì„±`);
            return result;
        }

        // ë¡œì»¬ ë°ì´í„°ìš© ê³ ìœ  í‚¤ ìƒì„±
        function generateLocalUniqueKey(record) {
            const date = new Date(record.timestamp).toISOString().split('T')[0];
            const studentId = record.studentId;
            const time = new Date(record.timestamp).toTimeString().split(' ')[0].substring(0, 5); // HH:mm í˜•ì‹
            const status = record.status;
            
            return `${date}_${studentId}_${status}_${time}`;
        }

        // ID ìƒì„± í—¬í¼ í•¨ìˆ˜
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        }

        // ğŸ†• ì›¹ì•± ë°ì´í„°ë¥¼ Google Sheetsë¡œ ë‚´ë³´ë‚´ê¸°
        async function exportToGoogleSheets() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            // í™•ì¸ ëŒ€í™”ìƒì
            if (!confirm('ğŸš€ ì›¹ì•±ì˜ ëª¨ë“  ì¶œì„ ë°ì´í„°ë¥¼ Google Sheetsë¡œ ë™ê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nğŸ“Š í˜„ì¬ ì›¹ì•± ë°ì´í„°ê°€ "ì›¹ì•± ì¶œê²° ê¸°ë¡" ì‹œíŠ¸ì— ì €ì¥ë©ë‹ˆë‹¤.')) {
                return;
            }
            
            try {
                // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                button.innerHTML = '<i class="fas fa-spinner fa-spin text-lg mb-1 block"></i><div class="font-medium">ì „ì†¡ ì¤‘...</div><div class="text-xs opacity-80">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>';
                button.disabled = true;
                
                // í˜„ì¬ ì›¹ì•±ì˜ ëª¨ë“  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const attendanceData = JSON.parse(localStorage.getItem('attendanceData') || '[]');
                
                if (attendanceData.length === 0) {
                    alert('ğŸ“­ ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.\n\nì›¹ì•±ì— ì¶œì„ ë°ì´í„°ê°€ ìˆì–´ì•¼ Google Sheetsë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }
                
                console.log(`ğŸ“¤ Google Sheetsë¡œ ì „ì†¡í•  ë°ì´í„°: ${attendanceData.length}ê±´`);
                console.log('ğŸ” ì²« ë²ˆì§¸ ë ˆì½”ë“œ ìƒ˜í”Œ:', attendanceData[0]);
                
                // Google Apps Scriptë¡œ ë°ì´í„° ì „ì†¡
                const response = await fetch('https://script.google.com/macros/s/AKfycbxBZekl8Dx9LGDHCEz9_-U8Mm5R0Qo0aj3VJWOxgavIPE1KGF8KWJR17Wf9BdcrDKsT/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'syncToSheets',
                        attendanceData: attendanceData
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('ğŸ“Š Google Sheets ë™ê¸°í™” ê²°ê³¼:', result);
                
                if (result.success) {
                    // ì„±ê³µ ë©”ì‹œì§€
                    let message = `ğŸ‰ Google Sheets ë™ê¸°í™” ì™„ë£Œ!\n\n`;
                    message += `ğŸ“Š ì²˜ë¦¬ ê²°ê³¼:\n`;
                    message += `â€¢ ì „ì²´ ë°ì´í„°: ${result.totalProcessed}ê±´\n`;
                    message += `â€¢ ìƒˆë¡œ ì¶”ê°€: ${result.addedCount}ê±´\n`;
                    message += `â€¢ ì¤‘ë³µ ì œì™¸: ${result.skippedCount}ê±´\n`;
                    message += `â€¢ ì €ì¥ ìœ„ì¹˜: "${result.sheetName}" ì‹œíŠ¸\n\n`;
                    message += `ğŸ”— Google Sheetsì—ì„œ í™•ì¸í•˜ë ¤ë©´ "ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì—´ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.`;
                    
                    alert(message);
                    
                } else {
                    throw new Error(result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('Google Sheets ë™ê¸°í™” ì‹¤íŒ¨:', error);
                
                let errorMessage = 'âŒ Google Sheetsë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\n';
                
                if (error.message.includes('HTTP')) {
                    errorMessage += 'ğŸ”— ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.';
                } else if (error.message.includes('CORS')) {
                    errorMessage += 'ğŸ”’ CORS ì •ì±…ìœ¼ë¡œ ì¸í•œ ì°¨ë‹¨ì…ë‹ˆë‹¤. Google Apps Script ì„¤ì •ì„ í™•ì¸í•´ë³´ì„¸ìš”.';
                } else {
                    errorMessage += `ì˜¤ë¥˜ ë‚´ìš©: ${error.message}`;
                }
                
                alert(errorMessage);
                
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        // ğŸ”„ ì–‘ë°©í–¥ ì™„ì „ ë™ê¸°í™”
        async function syncBothWays() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            // í™•ì¸ ëŒ€í™”ìƒì
            if (!confirm('ğŸ”„ ì–‘ë°©í–¥ ì™„ì „ ë™ê¸°í™”ë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n1ï¸âƒ£ Google Sheets â†’ ì›¹ì‹œìŠ¤í…œ (ê°€ì ¸ì˜¤ê¸°)\n2ï¸âƒ£ ì›¹ì‹œìŠ¤í…œ â†’ Google Sheets (ë‚´ë³´ë‚´ê¸°)\n\nâš ï¸ ì´ ê³¼ì •ì€ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
                return;
            }
            
            try {
                button.innerHTML = '<i class="fas fa-spinner fa-spin text-lg mb-1 block"></i><div class="font-medium">ë™ê¸°í™” ì¤‘...</div><div class="text-xs opacity-80">1ë‹¨ê³„: ê°€ì ¸ì˜¤ê¸°</div>';
                button.disabled = true;
                
                let syncReport = {
                    step1: { success: false, details: null },
                    step2: { success: false, details: null }
                };
                
                // 1ë‹¨ê³„: Google Sheets â†’ ì›¹ì‹œìŠ¤í…œ (ê°€ì ¸ì˜¤ê¸°)
                console.log('ğŸ”„ 1ë‹¨ê³„: Google Sheetsì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œì‘');
                
                try {
                    // ì„ì‹œë¡œ importFromGoogleSheets ë¡œì§ ì‹¤í–‰
                    const beforeCount = JSON.parse(localStorage.getItem('attendanceData') || '[]').length;
                    
                    // Google Sheets ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    const response1 = await fetch('https://script.google.com/macros/s/AKfycbxBZekl8Dx9LGDHCEz9_-U8Mm5R0Qo0aj3VJWOxgavIPE1KGF8KWJR17Wf9BdcrDKsT/exec?action=getAllAttendance');
                    
                    if (!response1.ok) {
                        throw new Error(`Google Sheets ì¡°íšŒ ì‹¤íŒ¨: ${response1.status}`);
                    }
                    
                    const googleResult = await response1.json();
                    
                    if (!googleResult.success) {
                        throw new Error(googleResult.error || 'Google Sheets ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨');
                    }
                    
                    // ë°ì´í„° ë³€í™˜ ë° ì €ì¥
                    const existingData = JSON.parse(localStorage.getItem('attendanceData') || '[]');
                    const existingKeys = new Set();
                    existingData.forEach(record => {
                        const key = generateLocalUniqueKey(record);
                        existingKeys.add(key);
                    });
                    
                    let importedCount = 0;
                    let skippedCount = 0;
                    
                    googleResult.data.forEach(googleRecord => {
                        const localRecords = convertGoogleToLocalFormat(googleRecord);
                        localRecords.forEach(localRecord => {
                            const key = generateLocalUniqueKey(localRecord);
                            if (!existingKeys.has(key)) {
                                existingData.push(localRecord);
                                existingKeys.add(key);
                                importedCount++;
                            } else {
                                skippedCount++;
                            }
                        });
                    });
                    
                    // ì •ë ¬ ë° ì €ì¥
                    existingData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    localStorage.setItem('attendanceData', JSON.stringify(existingData));
                    
                    syncReport.step1 = {
                        success: true,
                        details: {
                            imported: importedCount,
                            skipped: skippedCount,
                            total: googleResult.data.length
                        }
                    };
                    
                    console.log('âœ… 1ë‹¨ê³„ ì™„ë£Œ:', syncReport.step1.details);
                    
                } catch (error) {
                    syncReport.step1 = {
                        success: false,
                        error: error.message
                    };
                    console.error('âŒ 1ë‹¨ê³„ ì‹¤íŒ¨:', error);
                }
                
                // 2ë‹¨ê³„: ì›¹ì‹œìŠ¤í…œ â†’ Google Sheets (ë‚´ë³´ë‚´ê¸°)
                button.innerHTML = '<i class="fas fa-spinner fa-spin text-lg mb-1 block"></i><div class="font-medium">ë™ê¸°í™” ì¤‘...</div><div class="text-xs opacity-80">2ë‹¨ê³„: ë‚´ë³´ë‚´ê¸°</div>';
                
                console.log('ğŸ”„ 2ë‹¨ê³„: ì›¹ì‹œìŠ¤í…œì—ì„œ Google Sheetsë¡œ ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì‹œì‘');
                
                try {
                    const attendanceData = JSON.parse(localStorage.getItem('attendanceData') || '[]');
                    
                    if (attendanceData.length > 0) {
                        const response2 = await fetch('https://script.google.com/macros/s/AKfycbxBZekl8Dx9LGDHCEz9_-U8Mm5R0Qo0aj3VJWOxgavIPE1KGF8KWJR17Wf9BdcrDKsT/exec', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                action: 'syncToSheets',
                                attendanceData: attendanceData
                            })
                        });
                        
                        if (!response2.ok) {
                            throw new Error(`Google Sheets ì „ì†¡ ì‹¤íŒ¨: ${response2.status}`);
                        }
                        
                        const exportResult = await response2.json();
                        
                        if (!exportResult.success) {
                            throw new Error(exportResult.error || 'Google Sheets ì „ì†¡ ì‹¤íŒ¨');
                        }
                        
                        syncReport.step2 = {
                            success: true,
                            details: exportResult
                        };
                        
                        console.log('âœ… 2ë‹¨ê³„ ì™„ë£Œ:', syncReport.step2.details);
                        
                    } else {
                        syncReport.step2 = {
                            success: true,
                            details: { message: 'ë‚´ë³´ë‚¼ ë°ì´í„° ì—†ìŒ', addedCount: 0, skippedCount: 0 }
                        };
                    }
                    
                } catch (error) {
                    syncReport.step2 = {
                        success: false,
                        error: error.message
                    };
                    console.error('âŒ 2ë‹¨ê³„ ì‹¤íŒ¨:', error);
                }
                
                // ê²°ê³¼ ë³´ê³ ì„œ ìƒì„±
                updateStats();
                showAll();
                
                let message = 'ğŸ”„ ì–‘ë°©í–¥ ë™ê¸°í™” ì™„ë£Œ!\n\n';
                
                // 1ë‹¨ê³„ ê²°ê³¼
                message += 'ğŸ“¥ 1ë‹¨ê³„ - Google Sheets â†’ ì›¹ì‹œìŠ¤í…œ:\n';
                if (syncReport.step1.success) {
                    message += `  âœ… ì„±ê³µ: ${syncReport.step1.details.imported}ê±´ ì¶”ê°€, ${syncReport.step1.details.skipped}ê±´ ì¤‘ë³µ\n`;
                } else {
                    message += `  âŒ ì‹¤íŒ¨: ${syncReport.step1.error}\n`;
                }
                
                message += '\n';
                
                // 2ë‹¨ê³„ ê²°ê³¼
                message += 'ğŸ“¤ 2ë‹¨ê³„ - ì›¹ì‹œìŠ¤í…œ â†’ Google Sheets:\n';
                if (syncReport.step2.success) {
                    message += `  âœ… ì„±ê³µ: ${syncReport.step2.details.addedCount || 0}ê±´ ì¶”ê°€, ${syncReport.step2.details.skippedCount || 0}ê±´ ì¤‘ë³µ\n`;
                } else {
                    message += `  âŒ ì‹¤íŒ¨: ${syncReport.step2.error}\n`;
                }
                
                message += '\nğŸ¯ ì–‘ë°©í–¥ ë™ê¸°í™”ê°€ ì™„ë£Œë˜ì–´ ë‘ ì‹œìŠ¤í…œì˜ ë°ì´í„°ê°€ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!';
                
                alert(message);
                
            } catch (error) {
                console.error('ì–‘ë°©í–¥ ë™ê¸°í™” ì˜¤ë¥˜:', error);
                alert(`âŒ ì–‘ë°©í–¥ ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n${error.message}`);
                
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        function openSpreadsheet() {
            // JJ ì„ ìƒë‹˜ì˜ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì§ì ‘ ì—´ê¸°
            const spreadsheetUrl = 'https://docs.google.com/spreadsheets/d/1dJEOyc59eZgwidKjXiYptgreAIabfBbkndN0g17Qsb8/edit';
            return window.open(spreadsheetUrl, '_blank');
        }

        // ========== ì‹œìŠ¤í…œ ì´ˆê¸°í™” ==========

        // ğŸ§¹ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìë™ ì •ë¦¬ í•¨ìˆ˜
        function cleanupTestData() {
            try {
                const allData = getData();
                const realData = allData.filter(item => item.source !== 'test_data');
                const testData = allData.filter(item => item.source === 'test_data');
                
                if (testData.length > 0) {
                    console.log('ğŸ§¹ admin: ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìë™ ì •ë¦¬:', testData.length + 'ê±´');
                    localStorage.setItem('attendanceData', JSON.stringify(realData));
                    console.log('âœ… admin: í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ, ì‹¤ì œ ë°ì´í„°:', realData.length + 'ê±´');
                }
            } catch (error) {
                console.warn('âš ï¸ admin: í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ ì‹¤íŒ¨:', error);
            }
        }

        window.onload = function() {
            console.log('ğŸ“ JJ ì„ ìƒë‹˜ ê´€ë¦¬ì ì‹œìŠ¤í…œ v9.0 ë¡œë“œ ì™„ë£Œ');
            console.log('ğŸ”— Google Apps Script v8 ì—°ë™ ì§€ì›');
            
            // ğŸ†• í…ŒìŠ¤íŠ¸ ë°ì´í„° ìë™ ì •ë¦¬
            cleanupTestData();
            
            document.getElementById('password').focus();
            
            // ì—°ê²° ìƒíƒœ ìë™ í™•ì¸
            setTimeout(checkConnection, 1000);
            
            // ì£¼ê¸°ì ìœ¼ë¡œ ì—°ê²° ìƒíƒœ í™•ì¸ (5ë¶„ë§ˆë‹¤)
            setInterval(checkConnection, 300000);
        };
    </script>
</body>
</html>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-normal { @apply bg-green-100 text-green-800; }
        .status-partial { @apply bg-yellow-100 text-yellow-800; }
        .status-missing { @apply bg-red-100 text-red-800; }
        .status-processed { @apply bg-blue-100 text-blue-800; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- í—¤ë” -->
    <header class="gradient-bg shadow-lg">
        <div class="max-w-6xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-white mb-1">
                        <i class="fas fa-chart-line mr-2"></i>ì‹¤ì‹œê°„ ì¶œê²° í˜„í™©
                    </h1>
                    <p class="text-indigo-100">ê´‘ì˜ì—¬ìê³ ë“±í•™êµ ì•„ì¹¨ììŠµ</p>
                </div>
                <div class="text-right text-white">
                    <div class="text-lg font-semibold" id="current-date"></div>
                    <div class="text-sm text-indigo-200" id="current-time"></div>
                    <div class="flex items-center justify-end mt-2">
                        <span class="w-2 h-2 bg-green-400 rounded-full pulse-dot mr-1" id="status-indicator"></span>
                        <span class="text-xs" id="status-text">ì—°ê²° í™•ì¸ ì¤‘...</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="max-w-6xl mx-auto px-4 py-8">
        <!-- ë¹ ë¥¸ í†µê³„ -->
        <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-8">
            <!-- ì „ì²´ ì¶œì„ -->
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-users text-blue-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-sm font-medium text-gray-500">ì „ì²´ ì¶œì„</h3>
                        <p class="text-2xl font-bold text-gray-900" id="total-count">0</p>
                    </div>
                </div>
            </div>

            <!-- ì •ìƒ ì™„ë£Œ -->
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-check-circle text-green-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-sm font-medium text-gray-500">ì •ìƒ ì™„ë£Œ</h3>
                        <p class="text-2xl font-bold text-gray-900" id="completed-count">0</p>
                    </div>
                </div>
            </div>

            <!-- ì§„í–‰ ì¤‘ -->
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clock text-yellow-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-sm font-medium text-gray-500">ì§„í–‰ ì¤‘</h3>
                        <p class="text-2xl font-bold text-gray-900" id="ongoing-count">0</p>
                    </div>
                </div>
            </div>

            <!-- ëˆ„ë½/ë¬¸ì œ -->
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-sm font-medium text-gray-500">ëˆ„ë½/ë¬¸ì œ</h3>
                        <p class="text-2xl font-bold text-gray-900" id="missing-count">0</p>
                    </div>
                </div>
            </div>

            <!-- ğŸ†• ì´ í•™ìŠµì‹œê°„ -->
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-stopwatch text-purple-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-sm font-medium text-gray-500">ì´ í•™ìŠµì‹œê°„</h3>
                        <p class="text-lg font-bold text-gray-900" id="total-study-time">0ì‹œê°„</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- í•„í„° ë° ê²€ìƒ‰ -->
        <div class="bg-white rounded-lg shadow p-4 mb-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div class="flex items-center space-x-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ë‚ ì§œ</label>
                        <select id="date-filter" class="border border-gray-300 rounded-md px-3 py-2">
                            <option value="">ì „ì²´ ë‚ ì§œ</option>
                            <option value="today">ì˜¤ëŠ˜</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ìƒíƒœ</label>
                        <select id="status-filter" class="border border-gray-300 rounded-md px-3 py-2">
                            <option value="">ì „ì²´</option>
                            <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                            <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
                            <option value="ëˆ„ë½">ëˆ„ë½</option>
                        </select>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="relative">
                        <input 
                            type="text" 
                            id="search-input" 
                            placeholder="í•™ë²ˆ ë˜ëŠ” ì´ë¦„ ê²€ìƒ‰..." 
                            class="border border-gray-300 rounded-md pl-10 pr-4 py-2 w-64"
                        >
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                    <button onclick="refreshData()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md">
                        <i class="fas fa-sync-alt mr-1"></i>ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>
            </div>
        </div>

        <!-- ì¶œê²° í˜„í™© í…Œì´ë¸” -->
        <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900">
                    <i class="fas fa-table mr-2 text-indigo-600"></i>
                    ì¶œê²° í˜„í™© ëª©ë¡
                </h2>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë‚ ì§œ</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">í•™ë²ˆ</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì´ë¦„</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì…ì‹¤ì‹œê°„</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">í‡´ì‹¤ì‹œê°„</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">í•™ìŠµì‹œê°„</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody id="attendance-table" class="bg-white divide-y divide-gray-200">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë°ì´í„° -->
                    </tbody>
                </table>
            </div>

            <!-- ë¹ˆ ìƒíƒœ -->
            <div id="empty-state" class="hidden text-center py-12">
                <i class="fas fa-chart-line text-gray-400 text-4xl mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-700 mb-2">ì¶œê²° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                <p class="text-gray-500 mb-6">ì•„ë˜ ë°©ë²•ìœ¼ë¡œ ì¶œê²° ë°ì´í„°ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”:</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-lg mx-auto">
                    <a href="admin.html" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors">
                        <i class="fas fa-cloud-download-alt mr-2"></i>Google Sheetsì—ì„œ ê°€ì ¸ì˜¤ê¸°
                    </a>
                    
                    <a href="index.html" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg transition-colors">
                        <i class="fas fa-plus mr-2"></i>ì§ì ‘ ì¶œê²° ì…ë ¥í•˜ê¸°
                    </a>
                </div>
                
                <div class="mt-8 text-sm text-gray-400">
                    <p>ğŸ’¡ <strong>ì¶”ì²œ:</strong> admin í˜ì´ì§€ì—ì„œ "ì „ì²´ ê¸°ì¡´ ë°ì´í„° í•œë²ˆì— ê°€ì ¸ì˜¤ê¸°"ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”</p>
                </div>
            </div>
        </div>

        <!-- ë¹ ë¥¸ ì•¡ì…˜ -->
        <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
            <a href="index.html" class="bg-white border border-gray-200 rounded-lg p-4 text-center hover:bg-gray-50 transition-colors">
                <i class="fas fa-plus-circle text-2xl text-indigo-600 mb-2"></i>
                <h3 class="font-medium text-gray-900">ì¶œê²° ì…ë ¥</h3>
                <p class="text-sm text-gray-500">ìƒˆë¡œìš´ ì¶œê²° ê¸°ë¡</p>
            </a>
            
            <a href="admin.html" class="bg-white border border-gray-200 rounded-lg p-4 text-center hover:bg-gray-50 transition-colors">
                <i class="fas fa-cogs text-2xl text-purple-600 mb-2"></i>
                <h3 class="font-medium text-gray-900">ê´€ë¦¬ì ë©”ë‰´</h3>
                <p class="text-sm text-gray-500">ë°ì´í„° ê´€ë¦¬ ë° ì„¤ì •</p>
            </a>
            
            <button onclick="exportData()" class="bg-white border border-gray-200 rounded-lg p-4 text-center hover:bg-gray-50 transition-colors">
                <i class="fas fa-download text-2xl text-green-600 mb-2"></i>
                <h3 class="font-medium text-gray-900">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h3>
                <p class="text-sm text-gray-500">Excel íŒŒì¼ë¡œ ì €ì¥</p>
            </button>
        </div>
    </main>

    <!-- API ëª¨ë“ˆ ë¡œë“œ -->
    <script src="js/api.js"></script>
    
    <script>
        // í˜„ì¬ ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateDateTime() {
            const now = new Date();
            document.getElementById('current-date').textContent = 
                now.toLocaleDateString('ko-KR', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric', 
                    weekday: 'long' 
                });
            document.getElementById('current-time').textContent = 
                now.toLocaleTimeString('ko-KR');
        }

        updateDateTime();
        setInterval(updateDateTime, 1000);

        // ğŸ†• ë‚ ì§œ í•„í„° ì´ˆê¸°í™” (ì „ì²´ê°€ ê¸°ë³¸ê°’)
        document.getElementById('date-filter').value = '';

        // ì¶œê²° ë°ì´í„° ë¡œë“œ ë° í‘œì‹œ  
        async function loadAttendanceData() {
            const selectedDateOption = document.getElementById('date-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            const searchTerm = document.getElementById('search-input').value.toLowerCase();

            // ë‚ ì§œ í•„í„° ê°’ ì²˜ë¦¬
            let selectedDate = null;
            if (selectedDateOption === 'today') {
                selectedDate = new Date().toISOString().split('T')[0];
            } else if (selectedDateOption) {
                selectedDate = selectedDateOption;
            }
            // ë¹ˆ ê°’('') ë˜ëŠ” 'all'ì´ë©´ selectedDate = null (ì „ì²´)

            console.log('ğŸ“Š status.htmlì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œë„:', selectedDateOption, 'â†’', selectedDate);
            
            // ğŸ†• ì§ì ‘ Google Sheets ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œë„
            let allData = [];
            
            try {
                console.log('ğŸ“¡ ì§ì ‘ Google Apps Script í˜¸ì¶œ...');
                const googleResponse = await fetch('https://script.google.com/macros/s/AKfycbxBZekl8Dx9LGDHCEz9_-U8Mm5R0Qo0aj3VJWOxgavIPE1KGF8KWJR17Wf9BdcrDKsT/exec?action=getAllAttendance');
                
                if (googleResponse.ok) {
                    const googleResult = await googleResponse.json();
                    console.log('ğŸ“Š Google Sheets ì§ì ‘ ì¡°íšŒ ê²°ê³¼:', googleResult);
                    
                    if (googleResult.success && googleResult.data) {
                        // Google Sheets ë°ì´í„°ë¥¼ ì›¹ì‹œìŠ¤í…œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                        googleResult.data.forEach(googleRecord => {
                            // ì…ì‹¤ ê¸°ë¡ ìƒì„±
                            if (googleRecord.checkInTime) {
                                const baseDate = typeof googleRecord.date === 'string' ? 
                                    googleRecord.date : 
                                    new Date(googleRecord.date).toISOString().split('T')[0];
                                
                                const checkInDateTime = new Date(`${baseDate}T${googleRecord.checkInTime}`);
                                
                                if (!isNaN(checkInDateTime.getTime())) {
                                    allData.push({
                                        id: `${googleRecord.id}-checkin`,
                                        studentId: googleRecord.studentId,
                                        studentName: googleRecord.studentName,
                                        status: 'ì…ì‹¤',
                                        timestamp: checkInDateTime.toISOString(),
                                        source: 'google_sheets'
                                    });
                                }
                            }
                            
                            // í‡´ì‹¤ ê¸°ë¡ ìƒì„±
                            if (googleRecord.checkOutTime) {
                                const baseDate = typeof googleRecord.date === 'string' ? 
                                    googleRecord.date : 
                                    new Date(googleRecord.date).toISOString().split('T')[0];
                                
                                const checkOutDateTime = new Date(`${baseDate}T${googleRecord.checkOutTime}`);
                                
                                if (!isNaN(checkOutDateTime.getTime())) {
                                    allData.push({
                                        id: `${googleRecord.id}-checkout`,
                                        studentId: googleRecord.studentId,
                                        studentName: googleRecord.studentName,
                                        status: 'í‡´ì‹¤',
                                        timestamp: checkOutDateTime.toISOString(),
                                        source: 'google_sheets'
                                    });
                                }
                            }
                        });
                        
                        console.log(`ğŸ“Š Google Sheetsì—ì„œ ë³€í™˜ëœ ë°ì´í„°: ${allData.length}ê±´`);
                    }
                }
            } catch (googleError) {
                console.warn('Google Sheets ì§ì ‘ ì¡°íšŒ ì‹¤íŒ¨:', googleError);
            }
            
            // ë¡œì»¬ ë°ì´í„°ë„ ì¶”ê°€
            try {
                const localData = JSON.parse(localStorage.getItem('attendanceData') || '[]');
                console.log(`ğŸ“Š ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°ì´í„°: ${localData.length}ê±´`);
                
                // ğŸ†• ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ adminì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„° í™•ì¸
                if (localData.length === 0) {
                    console.log('ğŸ” admin í˜ì´ì§€ì—ì„œ ì €ì¥ëœ ë°ì´í„° í™•ì¸ ì¤‘...');
                    
                    // admin í˜ì´ì§€ì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
                    const keys = Object.keys(localStorage);
                    console.log('ğŸ“‹ í˜„ì¬ localStorage í‚¤ë“¤:', keys);
                    
                    // ğŸ†• localStorageì—ì„œ ë‹¤ë¥¸ í‚¤ë¡œ ì €ì¥ëœ ë°ì´í„°ë„ í™•ì¸
                    console.log('ğŸ” ëª¨ë“  localStorage ë°ì´í„° í™•ì¸ ì¤‘...');
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        const value = localStorage.getItem(key);
                        console.log(`ğŸ“¦ localStorage[${key}]:`, value ? value.substring(0, 100) + '...' : 'null');
                    }
                    
                    // ğŸ†• ì‹¤ì œ ë°ì´í„°ë§Œ ì‚¬ìš© (í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì•ˆ í•¨)
                    const adminData = JSON.parse(localStorage.getItem('attendanceData') || '[]');
                    const realData = adminData.filter(item => item.source !== 'test_data');
                    
                    if (realData.length > 0) {
                        console.log('âœ… ì‹¤ì œ ë°ì´í„° ë°œê²¬:', realData.length + 'ê±´');
                        allData = allData.concat(realData);
                    } else {
                        console.log('ğŸ“­ ì‹¤ì œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¹ˆ ìƒíƒœë¡œ í‘œì‹œí•©ë‹ˆë‹¤.');
                        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±í•˜ì§€ ì•ŠìŒ - ë¹ˆ ìƒíƒœ ìœ ì§€
                    }
                } else {
                    allData = allData.concat(localData);
                }
            } catch (localError) {
                console.warn('ë¡œì»¬ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', localError);
            }
            
            console.log(`ğŸ“Š ì´ ë°ì´í„°: ${allData.length}ê±´`);
            
            if (allData.length === 0) {
                console.log('ğŸ“­ í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                document.getElementById('attendance-table').innerHTML = '';
                document.getElementById('empty-state').classList.remove('hidden');
                updateStatistics([]);
                return;
            } else {
                console.log('âœ… ë°ì´í„°ê°€ ìˆìŒ, UI ì—…ë°ì´íŠ¸ ì‹œì‘');
                // ë¹ˆ ìƒíƒœ ìˆ¨ê¸°ê¸°
                document.getElementById('empty-state').classList.add('hidden');
                
                // ğŸ†• ë‚ ì§œ ì˜µì…˜ ë™ì  ìƒì„±
                updateDateFilterOptions(allData);
            }

            // ğŸ†• ë‚ ì§œ í•„í„°ë§ (nullì´ë©´ ì „ì²´, ê°’ì´ ìˆìœ¼ë©´ í•´ë‹¹ ë‚ ì§œë§Œ)
            let filteredData = allData;
            if (selectedDate) {
                filteredData = allData.filter(record => {
                    const recordDate = new Date(record.timestamp).toISOString().split('T')[0];
                    return recordDate === selectedDate;
                });
                console.log(`ğŸ“… ${selectedDate} í•„í„°ë§ ê²°ê³¼: ${filteredData.length}ê±´`);
            } else {
                console.log('ğŸ“… ì „ì²´ ë‚ ì§œ í‘œì‹œ:', filteredData.length + 'ê±´');
            }
            
            // ê²€ìƒ‰ í•„í„°ë§
            if (searchTerm) {
                filteredData = filteredData.filter(record => {
                    return record.studentId.toLowerCase().includes(searchTerm) || 
                           record.studentName.toLowerCase().includes(searchTerm);
                });
            }
            
            console.log(`ğŸ“Š í•„í„°ë§ í›„ ë°ì´í„°: ${filteredData.length}ê±´`);

            // ğŸ†• ë‚ ì§œë³„ í•™ìƒ ë°ì´í„° ì§‘ê³„ (ë‚ ì§œë³„ë¡œ ë¶„ë¦¬)
            const dateStudentData = createDateStudentData(filteredData);
            
            // í†µê³„ìš© í•™ìƒë³„ ë°ì´í„° (ê¸°ì¡´ ë°©ì‹ - í†µê³„ìš©)
            const studentData = {};
            filteredData.forEach(record => {
                const key = record.studentId;
                if (!studentData[key]) {
                    studentData[key] = {
                        studentId: record.studentId,
                        studentName: record.studentName,
                        checkIn: null,
                        checkOut: null,
                        records: []
                    };
                }
                
                studentData[key].records.push(record);
                
                if (record.status === 'ì…ì‹¤') {
                    const checkTime = new Date(record.timestamp);
                    if (!studentData[key].checkIn || checkTime < new Date(studentData[key].checkIn.timestamp)) {
                        studentData[key].checkIn = record;
                    }
                } else if (record.status === 'í‡´ì‹¤') {
                    const checkTime = new Date(record.timestamp);
                    if (!studentData[key].checkOut || checkTime > new Date(studentData[key].checkOut.timestamp)) {
                        studentData[key].checkOut = record;
                    }
                }
            });

            // í†µê³„ ì—…ë°ì´íŠ¸
            const students = Object.values(studentData);
            console.log(`ğŸ‘¥ ì§‘ê³„ëœ í•™ìƒ ìˆ˜: ${students.length}ëª…`);
            console.log('ğŸ‘¥ í•™ìƒ ë°ì´í„° ìƒ˜í”Œ:', students[0]);
            
            updateStatistics(students);
            console.log('ğŸ“Š í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');

            // í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ë‚ ì§œë³„ ë°ì´í„° ì‚¬ìš©)
            updateAttendanceTable(dateStudentData, statusFilter);
            console.log('ğŸ“‹ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStatistics(studentData) {
            console.log('ğŸ“Š í†µê³„ ì—…ë°ì´íŠ¸ ì‹œì‘, í•™ìƒ ìˆ˜:', studentData.length);
            
            const total = studentData.length;
            let completed = 0;
            let ongoing = 0;
            let missing = 0;

            studentData.forEach(student => {
                console.log(`ğŸ‘¤ ${student.studentName}: ì…ì‹¤=${!!student.checkIn}, í‡´ì‹¤=${!!student.checkOut}`);
                if (student.checkIn && student.checkOut) {
                    completed++;
                } else if (student.checkIn && !student.checkOut) {
                    ongoing++;
                } else {
                    missing++;
                }
            });

            console.log(`ğŸ“Š í†µê³„: ì „ì²´=${total}, ì™„ë£Œ=${completed}, ì§„í–‰=${ongoing}, ëˆ„ë½=${missing}`);

            // DOM ì—˜ë¦¬ë¨¼íŠ¸ ì¡´ì¬ í™•ì¸ ë° ì—…ë°ì´íŠ¸
            const totalElement = document.getElementById('total-count');
            const completedElement = document.getElementById('completed-count');
            const ongoingElement = document.getElementById('ongoing-count');
            const missingElement = document.getElementById('missing-count');

            if (totalElement) {
                totalElement.textContent = total;
                console.log('âœ… total-count ì—…ë°ì´íŠ¸:', total);
            } else {
                console.error('âŒ total-count ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }

            if (completedElement) {
                completedElement.textContent = completed;
                console.log('âœ… completed-count ì—…ë°ì´íŠ¸:', completed);
            } else {
                console.error('âŒ completed-count ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }

            if (ongoingElement) {
                ongoingElement.textContent = ongoing;
                console.log('âœ… ongoing-count ì—…ë°ì´íŠ¸:', ongoing);
            } else {
                console.error('âŒ ongoing-count ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }

            if (missingElement) {
                missingElement.textContent = missing;
                console.log('âœ… missing-count ì—…ë°ì´íŠ¸:', missing);
            } else {
                console.error('âŒ missing-count ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
        }

        // ğŸ†• ë‚ ì§œë³„ í•™ìƒ ë°ì´í„° ìƒì„± (ê°œì„ ëœ ë²„ì „)
        function createDateStudentData(filteredData) {
            const dateStudentMap = {};
            
            // ë‚ ì§œë³„ë¡œ í•™ìƒ ë°ì´í„° ê·¸ë£¹í™”
            filteredData.forEach(record => {
                const recordDate = new Date(record.timestamp).toISOString().split('T')[0];
                const key = `${recordDate}_${record.studentId}`;
                
                if (!dateStudentMap[key]) {
                    dateStudentMap[key] = {
                        date: recordDate,
                        studentId: record.studentId,
                        studentName: record.studentName,
                        checkIn: null,
                        checkOut: null,
                        records: []
                    };
                }
                
                dateStudentMap[key].records.push(record);
                
                if (record.status === 'ì…ì‹¤') {
                    const checkTime = new Date(record.timestamp);
                    if (!dateStudentMap[key].checkIn || checkTime < new Date(dateStudentMap[key].checkIn.timestamp)) {
                        dateStudentMap[key].checkIn = record;
                    }
                } else if (record.status === 'í‡´ì‹¤') {
                    const checkTime = new Date(record.timestamp);
                    if (!dateStudentMap[key].checkOut || checkTime > new Date(dateStudentMap[key].checkOut.timestamp)) {
                        dateStudentMap[key].checkOut = record;
                    }
                }
            });
            
            return Object.values(dateStudentMap);
        }

        // í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ë‚ ì§œë³„ ì •ë ¬)
        function updateAttendanceTable(studentData, statusFilter) {
            console.log('ğŸ“‹ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œì‘, ë°ì´í„°:', studentData.length + 'ê±´');
            
            const tableBody = document.getElementById('attendance-table');
            const emptyState = document.getElementById('empty-state');

            if (studentData.length === 0) {
                tableBody.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');

            // ìƒíƒœë³„ í•„í„°ë§
            const filteredStudents = studentData.filter(student => {
                if (!statusFilter) return true;
                
                const status = getStudentStatus(student);
                return status.includes(statusFilter);
            });

            // ğŸ†• ë‚ ì§œë³„ ì •ë ¬ (ìµœì‹  ë‚ ì§œ ë¨¼ì €)
            filteredStudents.sort((a, b) => {
                const dateA = a.date || (a.checkIn ? new Date(a.checkIn.timestamp).toISOString().split('T')[0] : '0000-00-00');
                const dateB = b.date || (b.checkIn ? new Date(b.checkIn.timestamp).toISOString().split('T')[0] : '0000-00-00');
                return dateB.localeCompare(dateA);
            });

            // ğŸ†• ì´ í•™ìŠµì‹œê°„ ê³„ì‚°
            let totalMinutes = 0;
            
            tableBody.innerHTML = filteredStudents.map(student => {
                const date = student.date || (student.checkIn ? new Date(student.checkIn.timestamp).toLocaleDateString('ko-KR') : '-');
                const checkInTime = student.checkIn ? formatTime(student.checkIn.timestamp) : '-';
                const checkOutTime = student.checkOut ? formatTime(student.checkOut.timestamp) : '-';
                const studyTime = calculateStudyTime(student.checkIn, student.checkOut);
                const status = getStudentStatus(student);
                const statusBadge = getStatusBadge(status);

                // í•™ìŠµì‹œê°„ì„ ë¶„ìœ¼ë¡œ ë³€í™˜í•´ì„œ ì´í•©ì— ì¶”ê°€
                if (student.checkIn && student.checkOut) {
                    const start = new Date(student.checkIn.timestamp);
                    const end = new Date(student.checkOut.timestamp);
                    const diffMs = end - start;
                    const diffMins = Math.floor(diffMs / (1000 * 60));
                    if (diffMins > 0 && diffMins <= 1440) { // 0ë¶„~24ì‹œê°„ ì‚¬ì´ë§Œ
                        totalMinutes += diffMins;
                    }
                }

                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">${student.studentId}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student.studentName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${checkInTime}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${checkOutTime}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">${studyTime}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${statusBadge}</td>
                    </tr>
                `;
            }).join('');

            // ğŸ†• ì´ í•™ìŠµì‹œê°„ í‘œì‹œ
            updateTotalStudyTime(totalMinutes);
            console.log('ğŸ“Š ì´ í•™ìŠµì‹œê°„:', totalMinutes + 'ë¶„');
        }

        // ğŸ†• ì´ í•™ìŠµì‹œê°„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateTotalStudyTime(totalMinutes) {
            const element = document.getElementById('total-study-time');
            if (!element) return;
            
            if (totalMinutes <= 0) {
                element.textContent = '0ì‹œê°„';
                return;
            }
            
            const totalHours = Math.floor(totalMinutes / 60);
            const remainingMins = totalMinutes % 60;
            
            if (totalHours > 0) {
                if (remainingMins > 0) {
                    element.textContent = `${totalHours}ì‹œê°„ ${remainingMins}ë¶„`;
                } else {
                    element.textContent = `${totalHours}ì‹œê°„`;
                }
            } else {
                element.textContent = `${remainingMins}ë¶„`;
            }
        }

        // ğŸ†• ë‚ ì§œ í•„í„° ì˜µì…˜ ë™ì  ìƒì„±
        function updateDateFilterOptions(allData) {
            const dateFilter = document.getElementById('date-filter');
            const currentValue = dateFilter.value;
            
            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ê¸°ë³¸ ì˜µì…˜ ì œì™¸)
            while (dateFilter.children.length > 2) {
                dateFilter.removeChild(dateFilter.lastChild);
            }
            
            // ë°ì´í„°ì—ì„œ ê³ ìœ í•œ ë‚ ì§œ ì¶”ì¶œ
            const dates = new Set();
            allData.forEach(record => {
                const recordDate = new Date(record.timestamp).toISOString().split('T')[0];
                dates.add(recordDate);
            });
            
            // ë‚ ì§œ ì •ë ¬ (ìµœì‹ ìˆœ)
            const sortedDates = Array.from(dates).sort((a, b) => b.localeCompare(a));
            
            // ì˜µì…˜ ì¶”ê°€
            sortedDates.forEach(date => {
                const option = document.createElement('option');
                option.value = date;
                option.textContent = new Date(date + 'T00:00:00').toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'short'
                });
                dateFilter.appendChild(option);
            });
            
            // ì´ì „ ê°’ ë³µì›
            dateFilter.value = currentValue;
            
            console.log('ğŸ“… ë‚ ì§œ ì˜µì…˜ ì—…ë°ì´íŠ¸:', sortedDates.length + 'ê°œ ë‚ ì§œ');
        }

        // í•™ìƒ ìƒíƒœ ê³„ì‚°
        function getStudentStatus(student) {
            if (student.checkIn && student.checkOut) {
                return 'ì™„ë£Œ';
            } else if (student.checkIn && !student.checkOut) {
                return 'ì§„í–‰ì¤‘';
            } else {
                return 'ëˆ„ë½';
            }
        }

        // ìƒíƒœ ë°°ì§€ ìƒì„±
        function getStatusBadge(status) {
            const badgeClasses = {
                'ì™„ë£Œ': 'status-badge status-normal',
                'ì§„í–‰ì¤‘': 'status-badge status-partial', 
                'ëˆ„ë½': 'status-badge status-missing'
            };

            const icons = {
                'ì™„ë£Œ': 'fas fa-check-circle',
                'ì§„í–‰ì¤‘': 'fas fa-clock',
                'ëˆ„ë½': 'fas fa-exclamation-triangle'
            };

            return `<span class="${badgeClasses[status]}">
                <i class="${icons[status]} mr-1"></i>${status}
            </span>`;
        }

        // í•™ìŠµì‹œê°„ ê³„ì‚° (ìˆ˜ì •ëœ ë²„ì „)
        function calculateStudyTime(checkIn, checkOut) {
            if (!checkIn || !checkOut) return '-';
            
            console.log('ğŸ• í•™ìŠµì‹œê°„ ê³„ì‚°:', {
                checkIn: checkIn.timestamp,
                checkOut: checkOut.timestamp,
                checkInName: checkIn.studentName
            });
            
            const start = new Date(checkIn.timestamp);
            const end = new Date(checkOut.timestamp);
            
            // ë‚ ì§œ ìœ íš¨ì„± ê²€ì‚¬
            if (isNaN(start.getTime()) || isNaN(end.getTime())) {
                console.warn('âš ï¸ ì˜ëª»ëœ ë‚ ì§œ í˜•ì‹:', { start, end });
                return 'ì˜¤ë¥˜';
            }
            
            const diffMs = end - start;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            
            console.log('ğŸ• ì‹œê°„ ì°¨ì´:', {
                diffMs: diffMs,
                diffMins: diffMins,
                hours: Math.floor(diffMins / 60)
            });
            
            // ìŒìˆ˜ì´ê±°ë‚˜ 24ì‹œê°„ ì´ìƒì´ë©´ ì˜¤ë¥˜
            if (diffMins <= 0) return 'ì…ì‹¤ í›„ í‡´ì‹¤';
            if (diffMins > 1440) { // 24ì‹œê°„ = 1440ë¶„
                console.warn('âš ï¸ ë¹„ì •ìƒì ìœ¼ë¡œ ê¸´ í•™ìŠµì‹œê°„:', diffMins + 'ë¶„');
                return 'ê³„ì‚°ì˜¤ë¥˜';
            }
            
            const hours = Math.floor(diffMins / 60);
            const mins = diffMins % 60;
            
            if (hours > 0) {
                return `${hours}ì‹œê°„ ${mins}ë¶„`;
            } else {
                return `${mins}ë¶„`;
            }
        }

        // ì‹œê°„ í¬ë§·íŒ…
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('ko-KR', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        // í•™ìƒ ë¹„ê³ ì‚¬í•­
        function getStudentNotes(student) {
            const notes = [];
            
            if (student.checkIn) {
                const checkInTime = new Date(student.checkIn.timestamp);
                const hour = checkInTime.getHours();
                
                if (hour >= 8) {
                    notes.push('ì§€ê° ì…ì‹¤');
                } else if (hour < 5) {
                    notes.push('ì‹œê°„ì™¸ ì…ì‹¤');
                }
            }
            
            if (student.checkOut) {
                const checkOutTime = new Date(student.checkOut.timestamp);
                const hour = checkOutTime.getHours();
                const minute = checkOutTime.getMinutes();
                
                if (hour > 7 || (hour === 7 && minute > 50)) {
                    notes.push('ëŠ¦ì€ í‡´ì‹¤');
                }
            }
            
            return notes.length > 0 ? notes.join(', ') : '-';
        }

        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        async function refreshData() {
            await loadAttendanceData();
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportData() {
            try {
                const result = window.attendanceAPI.exportData('csv');
                if (result.success) {
                    alert(result.message);
                }
            } catch (error) {
                alert(error.message);
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('date-filter').addEventListener('change', loadAttendanceData);
        document.getElementById('status-filter').addEventListener('change', loadAttendanceData);
        document.getElementById('search-input').addEventListener('input', loadAttendanceData);

        // ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updateConnectionStatus() {
            try {
                // APIê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (typeof window.attendanceAPI === 'undefined') {
                    const indicator = document.getElementById('status-indicator');
                    const text = document.getElementById('status-text');
                    indicator.className = 'w-2 h-2 bg-yellow-400 rounded-full pulse-dot mr-1';
                    text.textContent = 'API ë¡œë”© ì¤‘...';
                    return;
                }

                const status = await window.attendanceAPI.checkConnection();
                const indicator = document.getElementById('status-indicator');
                const text = document.getElementById('status-text');
                
                console.log('ğŸ” ì—°ê²° ìƒíƒœ ì²´í¬ ê²°ê³¼:', status);
                
                if (status.connected === true) {
                    indicator.className = 'w-2 h-2 bg-green-400 rounded-full pulse-dot mr-1';
                    text.textContent = 'Google Sheets ì—°ë™';
                } else if (status.connected === 'unknown') {
                    indicator.className = 'w-2 h-2 bg-blue-400 rounded-full pulse-dot mr-1';
                    text.textContent = 'í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ';
                } else {
                    indicator.className = 'w-2 h-2 bg-yellow-400 rounded-full pulse-dot mr-1';
                    text.textContent = 'ë¡œì»¬ ëª¨ë“œ';
                }
            } catch (error) {
                console.warn('ì—°ê²° ìƒíƒœ ì²´í¬ ì˜¤ë¥˜:', error);
                const indicator = document.getElementById('status-indicator');
                const text = document.getElementById('status-text');
                
                // ë” ìƒì„¸í•œ ìƒíƒœ í‘œì‹œ
                if (error.message && error.message.includes('fetch')) {
                    indicator.className = 'w-2 h-2 bg-blue-400 rounded-full pulse-dot mr-1';
                    text.textContent = 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ';
                } else {
                    indicator.className = 'w-2 h-2 bg-green-400 rounded-full pulse-dot mr-1';
                    text.textContent = 'ë¡œì»¬ ì‹œìŠ¤í…œ ì‘ë™';
                }
            }
        }

        // API ë¡œë“œ ëŒ€ê¸° ë° ì´ˆê¸°í™”
        function initializeApp() {
            console.log('ğŸš€ ì•± ì´ˆê¸°í™” ì‹œì‘...');
            console.log('ğŸ” window.attendanceAPI ì¡´ì¬ ì—¬ë¶€:', typeof window.attendanceAPI);
            
            if (typeof window.attendanceAPI === 'undefined') {
                console.log('â³ API ë¡œë”© ëŒ€ê¸° ì¤‘...');
                // APIê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸° (ìµœëŒ€ 10ì´ˆ)
                let attempts = 0;
                const checkAPI = setInterval(() => {
                    attempts++;
                    console.log(`ğŸ” API ì²´í¬ ì‹œë„ ${attempts}/20`);
                    
                    if (typeof window.attendanceAPI !== 'undefined') {
                        console.log('âœ… API ë¡œë“œ ì™„ë£Œ!');
                        clearInterval(checkAPI);
                        startApp();
                    } else if (attempts >= 20) {
                        console.log('âŒ API ë¡œë“œ ì‹¤íŒ¨, ì§ì ‘ ëª¨ë“œë¡œ ì „í™˜');
                        clearInterval(checkAPI);
                        startAppWithoutAPI();
                    }
                }, 500);
            } else {
                console.log('âœ… API ì´ë¯¸ ë¡œë“œë¨');
                startApp();
            }
        }

        // API ì‚¬ìš© ëª¨ë“œë¡œ ì‹œì‘
        function startApp() {
            console.log('ğŸ¯ API ëª¨ë“œë¡œ ì•± ì‹œì‘');
            loadAttendanceData();
            updateConnectionStatus();

            // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (30ì´ˆë§ˆë‹¤)
            setInterval(() => {
                loadAttendanceData();
                updateConnectionStatus();
            }, 30000);
        }

        // API ì—†ì´ ì§ì ‘ ëª¨ë“œë¡œ ì‹œì‘
        function startAppWithoutAPI() {
            console.log('ğŸ¯ ì§ì ‘ ëª¨ë“œë¡œ ì•± ì‹œì‘');
            
            // ì—°ê²° ìƒíƒœë¥¼ ë¡œì»¬ ëª¨ë“œë¡œ ì„¤ì •
            const indicator = document.getElementById('status-indicator');
            const text = document.getElementById('status-text');
            indicator.className = 'w-2 h-2 bg-yellow-400 rounded-full pulse-dot mr-1';
            text.textContent = 'ì§ì ‘ ëª¨ë“œ';
            
            // ì§ì ‘ ë°ì´í„° ë¡œë“œ
            loadAttendanceDataDirect();
        }

        // API ì—†ì´ ì§ì ‘ ë°ì´í„° ë¡œë“œ
        async function loadAttendanceDataDirect() {
            console.log('ğŸ“Š ì§ì ‘ ëª¨ë“œë¡œ ë°ì´í„° ë¡œë“œ');
            
            // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
            const testData = [
                {
                    id: 'test1',
                    studentId: '12345',
                    studentName: 'ê¹€ê´‘ì˜',
                    status: 'ì…ì‹¤',
                    timestamp: '2025-09-27T06:30:00.000Z',
                    source: 'test_data'
                },
                {
                    id: 'test2', 
                    studentId: '12345',
                    studentName: 'ê¹€ê´‘ì˜', 
                    status: 'í‡´ì‹¤',
                    timestamp: '2025-09-27T07:45:00.000Z',
                    source: 'test_data'
                },
                {
                    id: 'test3',
                    studentId: '23456',
                    studentName: 'ë°•ì˜í¬',
                    status: 'ì…ì‹¤',
                    timestamp: '2025-09-27T06:25:00.000Z', 
                    source: 'test_data'
                }
            ];
            
            console.log('ğŸ“Š í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±:', testData.length + 'ê±´');
            
            // í•™ìƒë³„ ë°ì´í„° ì§‘ê³„
            const studentData = {};
            testData.forEach(record => {
                const key = record.studentId;
                if (!studentData[key]) {
                    studentData[key] = {
                        studentId: record.studentId,
                        studentName: record.studentName,
                        checkIn: null,
                        checkOut: null,
                        records: []
                    };
                }
                
                studentData[key].records.push(record);
                
                if (record.status === 'ì…ì‹¤') {
                    studentData[key].checkIn = record;
                } else if (record.status === 'í‡´ì‹¤') {
                    studentData[key].checkOut = record;
                }
            });

            // í†µê³„ ë° í…Œì´ë¸” ì—…ë°ì´íŠ¸
            updateStatistics(Object.values(studentData));
            updateAttendanceTable(Object.values(studentData), '');
        }

        // ğŸ†• localStorage ë³€í™” ê°ì§€ (adminì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¬ ë•Œ)
        window.addEventListener('storage', function(e) {
            if (e.key === 'attendanceData') {
                console.log('ğŸ“¡ localStorage ë³€í™” ê°ì§€! ë°ì´í„° ìƒˆë¡œê³ ì¹¨...');
                loadAttendanceData();
            }
        });

        // ğŸ†• ê°™ì€ í˜ì´ì§€ ë‚´ì—ì„œ localStorage ë³€í™” ê°ì§€
        const originalSetItem = localStorage.setItem;
        localStorage.setItem = function(key, value) {
            originalSetItem.call(this, key, value);
            if (key === 'attendanceData') {
                console.log('ğŸ“¡ attendanceData ì—…ë°ì´íŠ¸ ê°ì§€!');
                setTimeout(() => loadAttendanceData(), 100);
            }
        };

        // ğŸ§¹ ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìë™ ì •ë¦¬
        function cleanupTestData() {
            try {
                const allData = JSON.parse(localStorage.getItem('attendanceData') || '[]');
                const realData = allData.filter(item => item.source !== 'test_data');
                const testData = allData.filter(item => item.source === 'test_data');
                
                if (testData.length > 0) {
                    console.log('ğŸ§¹ ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬:', testData.length + 'ê±´');
                    localStorage.setItem('attendanceData', JSON.stringify(realData));
                    console.log('âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ, ì‹¤ì œ ë°ì´í„°:', realData.length + 'ê±´');
                }
            } catch (error) {
                console.warn('âš ï¸ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ ì‹¤íŒ¨:', error);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ í›„ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ DOM ë¡œë“œ ì™„ë£Œ');
            cleanupTestData(); // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìë™ ì •ë¦¬
            setTimeout(initializeApp, 100); // 100ms ì§€ì—° í›„ ì´ˆê¸°í™”
        });

        // API ìŠ¤í¬ë¦½íŠ¸ê°€ ì´ë¯¸ ë¡œë“œëœ ê²½ìš°ë¥¼ ìœ„í•œ fallback
        setTimeout(initializeApp, 1000); // 1ì´ˆ í›„ ê°•ì œ ì´ˆê¸°í™”
    </script>
</body>
</html>
